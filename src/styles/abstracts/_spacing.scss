@charset 'UTF-8';
@use 'sass:map';
@use 'tokens' as *; // Legacy tokens (fallback si $ENABLE_LEGACY_SUPPORT)
@use 'semantics' as sem; // Phase 6 semantics (priorité)
@use 'primitives' as prim; // Phase 6 primitives (si sémantique absent)

// Feature flag (défini dans _index.scss)
$ENABLE_LEGACY_SUPPORT: true !default;

/// ============================================================================
/// SPACING SYSTEM - Wrapper Intelligent avec Fallback Phase 6
/// ============================================================================
/// ✅ PHASE 6 : Logique de fallback multi-couches
///
/// ARCHITECTURE :
///   1. Cherche dans $spacing-semantic (Phase 6 - noms métier)
///   2. Si absent → Cherche dans $spacing-primitives (Phase 6 - valeurs brutes)
///   3. Si absent → Cherche dans $spacing-tokens (Legacy - Phase 5)
///   4. Si absent → Erreur
///
/// MIGRATION PROGRESSIVE :
///   - Composants NON migrés : Utilisent legacy automatiquement
///   - Composants migrés : Utilisent semantics (nouveau design)
///   - Build JAMAIS cassé (fallback garantit compatibilité)
///
/// ⚠️ RÈGLE CRITIQUE : spacing() est UNIQUEMENT pour margin, padding, gap
///    Pour width/height/min-max, utiliser size() depuis _size.scss
///
/// EXEMPLES :
///   // Ancien code (Phase 5 - fonctionne toujours)
///   padding: spacing('md');        // → $spacing-tokens legacy
///
///   // Nouveau code (Phase 6 - design harmonisé)
///   padding: spacing('card-padding');  // → $spacing-semantic → 24px (12px au lieu de 16px)
/// ============================================================================

/// ============================================================================
/// FUNCTIONS
/// ============================================================================

/// Récupère une valeur d'espacement avec fallback intelligent Phase 6
/// @param {String} $key - Clé spacing (semantic, primitive, ou legacy)
/// @return {Length} Valeur de l'espacement (rem)
/// @example
///   // Phase 6 (nouveau - semantics)
///   padding: spacing('card-padding');     // 24px (semantic)
///   margin: spacing('touch-min');         // 44px (semantic)
///
///   // Phase 6 (nouveau - primitives)
///   gap: spacing('md');                   // 16px (primitive grille 4px)
///
///   // Phase 5 (legacy - fallback automatique)
///   padding: spacing('14');               // 14px (legacy, encore supporté)
@function spacing($key) {
  // 1. Priorité : Semantics (Phase 6 - noms métier auto-documentés)
  @if map.has-key(sem.$spacing-semantic, $key) {
    @return map.get(sem.$spacing-semantic, $key);
  }

  // 2. Fallback : Primitives (Phase 6 - grille 4px stricte)
  @else if map.has-key(prim.$spacing-primitives, $key) {
    @return map.get(prim.$spacing-primitives, $key);
  }

  // 3. Fallback : Legacy tokens (Phase 5 - conditionnel via feature flag)
  @else if $ENABLE_LEGACY_SUPPORT and map.has-key($spacing-tokens, $key) {
    @return map.get($spacing-tokens, $key);
  }

  // 4. Erreur si introuvable partout
  @else {
    @if $ENABLE_LEGACY_SUPPORT {
      @error "Spacing '#{$key}' not found in semantics, primitives, nor legacy tokens. Available semantic keys: #{map.keys(sem.$spacing-semantic)}. For width/height, use size() instead.";
    } @else {
      @error "Spacing '#{$key}' not found in semantics or primitives (legacy support disabled). Available semantic keys: #{map.keys(sem.$spacing-semantic)}. Migrate to Phase 6 tokens or enable $ENABLE_LEGACY_SUPPORT.";
    }
  }
}

/// Alias pour récupérer une valeur spacing (nom explicite)
/// @param {String} $key - Clé dans $spacing-tokens
/// @return {Length} Valeur de l'espacement (rem)
@function spacing-value($key) {
  @return spacing($key);
}

/// ============================================================================
/// CSS CUSTOM PROPERTIES - Pour accès runtime en JavaScript
/// ============================================================================

:root {
  // Scale primaire (utilisée partout)
  --spacing-none: #{spacing('none')};
  --spacing-xs: #{spacing('xs')};
  --spacing-sm: #{spacing('sm')};
  --spacing-md: #{spacing('md')};
  --spacing-lg: #{spacing('lg')};
  --spacing-xl: #{spacing('xl')};
  --spacing-2xl: #{spacing('2xl')};
  --spacing-3xl: #{spacing('3xl')};

  // Valeurs communes (pour JavaScript/CSS direct si besoin)
  --spacing-4: #{spacing('4')};
  --spacing-8: #{spacing('8')};
  --spacing-12: #{spacing('12')};
  --spacing-16: #{spacing('16')};
  --spacing-20: #{spacing('20')};
  --spacing-24: #{spacing('24')};
  --spacing-32: #{spacing('32')};
  --spacing-40: #{spacing('40')};
  --spacing-44: #{spacing('44')};
  --spacing-48: #{spacing('48')};
  --spacing-56: #{spacing('56')};
  --spacing-64: #{spacing('64')};
}

/// ============================================================================
/// GUIDELINES & BEST PRACTICES
/// ============================================================================
/// 1. JAMAIS hardcoder px/rem/em pour spacing - utiliser spacing($key)
/// 2. spacing() est UNIQUEMENT pour margin, padding, gap (respiration)
/// 3. Pour width/height/min-max, utiliser size() depuis _size.scss
/// 4. Mobile-first: définir valeurs de base, puis respond-to() breakpoints
/// 5. Garder cohérence entre spacings (4px base, multiples de 4)
/// 6. Touch targets: minimum 44px (WCAG AA) → spacing('44')
/// 7. Pour nouveaux espacements, ajouter à $spacing-tokens dans _tokens.scss
///
/// EXEMPLES :
///
/// ✅ CORRECT (respiration) :
///   padding: spacing('md');              // 1rem
///   margin-bottom: spacing('24');        // 1.5rem
///   gap: spacing('lg');                  // 1.5rem
///
/// ❌ INCORRECT (dimensions - utiliser size()) :
///   width: spacing('300');               // NON ! Utiliser size('300')
///   min-height: spacing('44');           // NON ! Utiliser size('touch-target-min')
///   max-width: spacing('600');           // NON ! Utiliser size('modal-width-md')
///
/// MIGRATION DEPUIS ANCIEN CODE :
///   - 'nav-mobile' (56px) → spacing('56')
///   - 'modal-padding' (32px) → spacing('32')
///   - 'touch-target' (44px) → spacing('44') ou size('touch-target-min')
///   - 'card-gap' (24px) → spacing('24')
///   - 'grid-gap' (16px) → spacing('16')
/// ============================================================================
