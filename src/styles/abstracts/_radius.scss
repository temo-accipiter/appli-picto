@charset 'UTF-8';
@use 'sass:map';
@use 'tokens' as *;             // Legacy tokens (fallback si $ENABLE_LEGACY_SUPPORT)
@use 'semantics' as sem;        // Phase 6 semantics (priorité)
@use 'primitives' as prim;      // Phase 6 primitives (si sémantique absent)

// Feature flag (défini dans _index.scss)
$ENABLE_LEGACY_SUPPORT: true !default;

/// ============================================================================
/// BORDER RADIUS - Wrapper Intelligent avec Fallback Phase 6
/// ============================================================================
/// ✅ PHASE 6 : Logique de fallback multi-couches
///
/// ARCHITECTURE :
///   1. Cherche dans $radius-semantic (Phase 6 - noms métier)
///   2. Si absent → Cherche dans $radius-primitives (Phase 6 - valeurs brutes)
///   3. Si absent → Cherche dans $radius-tokens (Legacy - Phase 5)
///   4. Si absent → Erreur
///
/// MIGRATION PROGRESSIVE :
///   - Composants NON migrés : Utilisent legacy automatiquement
///   - Composants migrés : Utilisent semantics (nouveau design)
///   - Build JAMAIS cassé (fallback garantit compatibilité)
///
/// EXEMPLES :
///   // Ancien code (Phase 5 - fonctionne toujours)
///   border-radius: radius('md');        // → $radius-tokens legacy → 8px
///
///   // Nouveau code (Phase 6 - design harmonisé)
///   border-radius: radius('card');      // → $radius-semantic → 12px (TSA-friendly)
/// ============================================================================

/// ============================================================================
/// FUNCTIONS
/// ============================================================================

/// Récupère une valeur de border-radius avec fallback intelligent Phase 6
/// @param {String} $key - Clé radius (semantic, primitive, ou legacy)
/// @return {Length|Percentage} Border-radius value (rem/px/%)
/// @example
///   // Phase 6 (nouveau - semantics)
///   border-radius: radius('card');       // 12px (semantic TSA-friendly)
///   border-radius: radius('button');     // 6px (semantic TSA-friendly)
///
///   // Phase 6 (nouveau - primitives)
///   border-radius: radius('md');         // 12px (primitive)
///
///   // Phase 5 (legacy - fallback automatique)
///   border-radius: radius('rounded-8px'); // 8px (legacy, encore supporté)
@function radius($key) {
  // 1. Priorité : Semantics (Phase 6 - noms métier auto-documentés)
  @if map.has-key(sem.$radius-semantic, $key) {
    @return map.get(sem.$radius-semantic, $key);
  }

  // 2. Fallback : Primitives (Phase 6 - grille 6/12/20px)
  @else if map.has-key(prim.$radius-primitives, $key) {
    @return map.get(prim.$radius-primitives, $key);
  }

  // 3. Fallback : Legacy tokens (Phase 5 - conditionnel via feature flag)
  @else if $ENABLE_LEGACY_SUPPORT and map.has-key($radius-tokens, $key) {
    @return map.get($radius-tokens, $key);
  }

  // 4. Erreur si introuvable partout
  @else {
    @if $ENABLE_LEGACY_SUPPORT {
      @error "Radius '#{$key}' not found in semantics, primitives, nor legacy tokens. Available semantic keys: #{map.keys(sem.$radius-semantic)}";
    } @else {
      @error "Radius '#{$key}' not found in semantics or primitives (legacy support disabled). Available semantic keys: #{map.keys(sem.$radius-semantic)}. Migrate to Phase 6 tokens or enable $ENABLE_LEGACY_SUPPORT.";
    }
  }
}

/// Alias pour radius() - utiliser quand nom explicite nécessaire
/// @param {String} $key - Clé dans $radius-tokens
/// @return {Number|Percentage} Border-radius value
@function radius-value($key) {
  @return radius($key);
}

/// ============================================================================
/// MIXINS - Helpers pour border-radius courants
/// ============================================================================

/// Applique un radius standard (card/container)
/// @param {String} $size - Taille du radius (défaut: md)
/// @example
///   @include rounded('lg');  // border-radius: 16px;
///   @include rounded();      // border-radius: 8px; (défaut md)
@mixin rounded($size: 'md') {
  border-radius: radius($size);
}

/// Crée un bouton avec border-radius (button specific)
/// @example
///   @include button-radius;  // border-radius: 8px;
@mixin button-radius {
  border-radius: radius('button');
}

/// Crée un input/select avec border-radius (input specific)
/// @example
///   @include input-radius;  // border-radius: 8px;
@mixin input-radius {
  border-radius: radius('input');
}

/// Crée un avatar circulaire
/// @example
///   @include avatar-radius;  // border-radius: 50%;
@mixin avatar-radius {
  border-radius: radius('avatar');
}

/// Crée un badge/pill shape
/// @example
///   @include badge-radius;  // border-radius: 50%;
@mixin badge-radius {
  border-radius: radius('badge');
}

/// Crée un modal/drawer avec radius
/// @example
///   @include modal-radius;  // border-radius: 16px;
@mixin modal-radius {
  border-radius: radius('modal');
}

/// ============================================================================
/// CSS CUSTOM PROPERTIES - Pour accès runtime (JavaScript)
/// ============================================================================

:root {
  // Scale primaire
  --radius-none: #{radius('none')};
  --radius-xs: #{radius('xs')};
  --radius-sm: #{radius('sm')};
  --radius-md: #{radius('md')};
  --radius-lg: #{radius('lg')};
  --radius-xl: #{radius('xl')};
  --radius-2xl: #{radius('2xl')};
  --radius-full: #{radius('full')};

  // Aliases sémantiques (pour JavaScript/CSS direct si besoin)
  --radius-default: #{radius('default')};
  --radius-card: #{radius('card')};
  --radius-button: #{radius('button')};
  --radius-input: #{radius('input')};
  --radius-modal: #{radius('modal')};
}

/// ============================================================================
/// GUIDELINES
/// ============================================================================
/// 1. JAMAIS hardcoder border-radius - utiliser radius($key)
/// 2. Utiliser aliases sémantiques (card, button, input, avatar) pour clarté
/// 3. radius('full') (50%) uniquement pour cercles/pills
/// 4. Cohérence: respecter progression 2px-4px-8px-16px-20px-24px
/// 5. Mobile-first: radius consistent across breakpoints (exception: rare)
/// 6. Accessibilité: radius ne doit pas gêner interaction (min 44x44 touch targets)
/// 7. Pour nouvelles valeurs, ajouter à $radius-tokens dans _tokens.scss
/// 8. WCAG: Assurer contraste suffisant autour des corners arrondis
/// 9. Performance: éviter border-radius excessive sur animations (reflow cost)
/// ============================================================================
