@use 'sass:map';
@use './tokens' as *;

// =============================================================================
// SYST√àME DE COULEURS - WRAPPER PUR (100% FONCTIONS)
// =============================================================================
/// ‚úÖ PHASE 2 COMPL√âT√âE (2025-12-14)
///
/// Ce fichier est maintenant un **WRAPPER PUR** :
///   - ‚ùå AUCUNE d√©finition de couleur locale (0 maps)
///   - ‚úÖ UNIQUEMENT des fonctions d'acc√®s
///   - ‚úÖ SOURCE DE V√âRIT√â = _tokens.scss (canonical)
///
/// R√àGLES STRICTES:
///   1. ‚ùå JAMAIS d√©finir maps de couleurs ici (use _tokens.scss)
///   2. ‚úÖ Fonctions lisent EXCLUSIVEMENT depuis _tokens.scss
///   3. ‚úÖ Validation stricte avec @error si cl√© invalide
///   4. ‚úÖ Composants utilisent ces fonctions (pas access direct aux maps)
///
/// MIGRATION COMPL√âT√âE:
///   Phase 1 ‚úÖ : Maps migr√©es vers _tokens.scss
///   Phase 2 ‚úÖ : Wrapper pur (ce fichier)
///   Phase 3 (SUIVANT) : Migrer composants pour utiliser fonctions tokens
///
/// Usage correct:
///   @use '@styles/abstracts' as *;
///   .my-class { background: color('base'); }          // ‚úÖ Lit $primary-color-tokens
///   .my-class { color: blue(500); }                   // ‚úÖ Lit $blue-palette-tokens
///   .my-class { border-color: semantic('success'); }  // ‚úÖ Lit $semantic-tokens
// =============================================================================

// =============================================================================
// FONCTIONS D'ACC√àS - Lisent depuis _tokens.scss (canonical source)
// =============================================================================

/// R√©cup√®re une couleur principale (depuis _tokens.scss)
/// @param {String} $key - Cl√© de la couleur (base, light, dark)
/// @param {String} $type - Type de couleur (primary, secondary, accent)
/// @return {Color} La couleur demand√©e
@function color($key, $type: 'primary') {
  // ‚úÖ Lit depuis les tokens canoniques
  $map: $primary-color-tokens;

  @if $type == 'secondary' {
    $map: $secondary-color-tokens;
  } @else if $type == 'accent' {
    $map: $accent-color-tokens;
  }

  @if map.has-key($map, $key) {
    @return map.get($map, $key);
  }

  @error "Color '#{$key}' not found in #{$type} colors (source: _tokens.scss)";
}

/// R√©cup√®re une couleur s√©mantique (depuis _tokens.scss)
/// @param {String} $name - Nom de la couleur (success, warning, error, info, info-primary)
/// @param {String} $variant - Variante (base, light, dark, bg, border) - d√©faut 'base'
/// @return {Color} La couleur demand√©e
@function semantic($name, $variant: 'base') {
  // ‚ö†Ô∏è Compatibilit√© : anciennes cl√©s plates (legacy)
  // 'info-primary' √©tait une cl√© directe dans l'ancien syst√®me
  @if $name == 'info-primary' {
    @return #66c3f7; // Valeur legacy pour compatibilit√© backward
  }

  // ‚úÖ Lit depuis $semantic-tokens (canonical)
  @if map.has-key($semantic-tokens, $name) {
    $semantic-map: map.get($semantic-tokens, $name);

    @if map.has-key($semantic-map, $variant) {
      @return map.get($semantic-map, $variant);
    }

    @error "Semantic variant '#{$variant}' not found for '#{$name}'. Available: base, light, dark, bg, border (source: _tokens.scss)";
  }

  @error "Semantic color '#{$name}' not found. Available: success, warning, error, info, info-primary (legacy) (source: _tokens.scss)";
}

/// R√©cup√®re une nuance de bleu (depuis _tokens.scss)
/// @param {Number} $shade - Nuance (50, 100, 200, ..., 900)
/// @return {Color} La couleur demand√©e
@function blue($shade) {
  // ‚úÖ Lit depuis $blue-palette-tokens (canonical)
  @if map.has-key($blue-palette-tokens, $shade) {
    @return map.get($blue-palette-tokens, $shade);
  }

  @error "Blue shade '#{$shade}' not found (source: _tokens.scss)";
}

/// R√©cup√®re une nuance de rouge (depuis _tokens.scss)
/// @param {Number} $shade - Nuance (50, 100, 200, ..., 900)
/// @return {Color} La couleur demand√©e
@function red($shade) {
  // ‚úÖ Lit depuis $red-palette-tokens (canonical)
  @if map.has-key($red-palette-tokens, $shade) {
    @return map.get($red-palette-tokens, $shade);
  }

  @error "Red shade '#{$shade}' not found (source: _tokens.scss)";
}

/// R√©cup√®re une nuance de vert (depuis _tokens.scss)
/// @param {Number} $shade - Nuance (50, 100, 200, ..., 900)
/// @return {Color} La couleur demand√©e
@function green($shade) {
  // ‚úÖ Lit depuis $green-palette-tokens (canonical)
  @if map.has-key($green-palette-tokens, $shade) {
    @return map.get($green-palette-tokens, $shade);
  }

  @error "Green shade '#{$shade}' not found (source: _tokens.scss)";
}

/// R√©cup√®re une nuance d'orange (depuis _tokens.scss)
/// @param {Number} $shade - Nuance (50, 100, 200, ..., 900)
/// @return {Color} La couleur demand√©e
@function orange($shade) {
  // ‚úÖ Lit depuis $orange-palette-tokens (canonical)
  @if map.has-key($orange-palette-tokens, $shade) {
    @return map.get($orange-palette-tokens, $shade);
  }

  @error "Orange shade '#{$shade}' not found (source: _tokens.scss)";
}

/// R√©cup√®re une nuance de jaune (depuis _tokens.scss)
/// @param {Number} $shade - Nuance (50, 100, 200, ..., 900)
/// @return {Color} La couleur demand√©e
@function yellow($shade) {
  // ‚úÖ Lit depuis $yellow-palette-tokens (canonical)
  @if map.has-key($yellow-palette-tokens, $shade) {
    @return map.get($yellow-palette-tokens, $shade);
  }

  @error "Yellow shade '#{$shade}' not found (source: _tokens.scss)";
}

/// R√©cup√®re une nuance de violet (depuis _tokens.scss)
/// @param {Number} $shade - Nuance (50, 100, 200, ..., 900)
/// @return {Color} La couleur demand√©e
@function purple($shade) {
  // ‚úÖ Lit depuis $purple-palette-tokens (canonical)
  @if map.has-key($purple-palette-tokens, $shade) {
    @return map.get($purple-palette-tokens, $shade);
  }

  @error "Purple shade '#{$shade}' not found (source: _tokens.scss)";
}

/// R√©cup√®re une nuance de slate (depuis _tokens.scss)
/// @param {Number} $shade - Nuance (50, 100, 200, ..., 900)
/// @return {Color} La couleur demand√©e
@function slate($shade) {
  // ‚úÖ Lit depuis $slate-palette-tokens (canonical)
  @if map.has-key($slate-palette-tokens, $shade) {
    @return map.get($slate-palette-tokens, $shade);
  }

  @error "Slate shade '#{$shade}' not found (source: _tokens.scss)";
}

/// R√©cup√®re une couleur de r√¥le (CANONICAL - lire depuis _tokens.scss)
/// @param {String} $role - Nom du r√¥le (admin, abonne, visitor, free, staff)
/// @param {String} $variant - Variante (base, light, dark, gradient-start, gradient-end)
///                            or legacy 'gradient' (alias for 'gradient-start')
/// @return {Color} La couleur demand√©e
///
/// ‚úÖ Phase 2 UPDATE: Cette fonction proxe maintenant vers _tokens.$role-color-tokens
///    (source de v√©rit√© canonical) au lieu de lire la map locale deprecated.
///
/// üìù Exemples:
///   role-color('admin', 'base') ‚Üí #667eea (violet)
///   role-color('admin', 'gradient-start') ‚Üí #667eea
///   role-color('admin', 'gradient-end') ‚Üí #764ba2
///   role-color('admin', 'gradient') ‚Üí #667eea (legacy alias, redirects to 'gradient-start')
///
/// ‚ö†Ô∏è NOTE: La map locale $role-colors est NOW READ-ONLY (deprecated).
@function role-color($role, $variant: 'base') {
  // Legacy alias support: 'gradient' ‚Üí 'gradient-start'
  $normalized-variant: $variant;
  @if $variant == 'gradient' {
    $normalized-variant: 'gradient-start';
  }

  // CANONICAL SOURCE: _tokens.$role-color-tokens
  @if map.has-key($role-color-tokens, $role) {
    $role-map: map.get($role-color-tokens, $role);

    @if map.has-key($role-map, $normalized-variant) {
      @return map.get($role-map, $normalized-variant);
    }

    @error "Role color variant '#{$normalized-variant}' (requested: '#{$variant}') not found for role '#{$role}'. Available: base, light, dark, gradient-start, gradient-end. See _tokens.scss for canonical values.";
  }

  @error "Role '#{$role}' not found in $role-color-tokens (canonical source in _tokens.scss)";
}

/// R√©cup√®re une couleur de texte (depuis _tokens.scss)
/// @param {String} $type - Type de texte (default, invert, light, dark, muted)
/// @return {Color} La couleur demand√©e
@function text($type: 'default') {
  // ‚úÖ Lit depuis $text-color-tokens (canonical)
  @if map.has-key($text-color-tokens, $type) {
    @return map.get($text-color-tokens, $type);
  }

  @error "Text color '#{$type}' not found (source: _tokens.scss)";
}

/// R√©cup√®re une couleur de surface (depuis _tokens.scss)
/// @param {String} $type - Type de surface (bg, surface, border, soft, hover)
/// @return {Color} La couleur demand√©e
@function surface($type) {
  // ‚úÖ Lit depuis $surface-color-tokens (canonical)
  @if map.has-key($surface-color-tokens, $type) {
    @return map.get($surface-color-tokens, $type);
  }

  @error "Surface color '#{$type}' not found (source: _tokens.scss)";
}

/// R√©cup√®re une couleur admin UI (depuis _tokens.scss)
/// @param {String} $key - Cl√© de la couleur (primary, secondary, success, danger, etc.)
/// @return {Color} La couleur demand√©e
@function admin-ui($key) {
  // ‚úÖ Lit depuis $admin-ui-color-tokens (canonical)
  @if map.has-key($admin-ui-color-tokens, $key) {
    @return map.get($admin-ui-color-tokens, $key);
  }

  @error "Admin UI color '#{$key}' not found (source: _tokens.scss)";
}

/// R√©cup√®re une couleur warning state (depuis _tokens.scss)
/// @param {String} $key - Cl√© de la couleur (warning, error, warning-bg, etc.)
/// @return {Color} La couleur demand√©e
@function warning($key) {
  // ‚úÖ Lit depuis $warning-state-color-tokens (canonical)
  @if map.has-key($warning-state-color-tokens, $key) {
    @return map.get($warning-state-color-tokens, $key);
  }

  @error "Warning state '#{$key}' not found (source: _tokens.scss)";
}

/// R√©cup√®re un gradient badge
/// @param {String} $role - Nom du r√¥le (abonne, free, visitor, admin, staff)
/// @return {Map} Map avec start/end du gradient
@function badge-gradient($role) {
  @if map.has-key($badge-gradients, $role) {
    @return map.get($badge-gradients, $role);
  }

  @error "Badge gradient '#{$role}' not found";
}

/// R√©cup√®re un gradient UI moderne
/// @param {String} $name - Nom du gradient (purple-modern, purple-modern-hover, blue-soft)
/// @return {Map} Map avec start/end du gradient
@function ui-gradient($name) {
  @if map.has-key($ui-gradients, $name) {
    @return map.get($ui-gradients, $name);
  }

  @error "UI gradient '#{$name}' not found";
}

/// R√©cup√®re une ombre badge
/// @param {String} $role - Nom du r√¥le + variante (abonne, abonne-hover, etc.)
/// @return {Color} La couleur d'ombre demand√©e
@function badge-shadow($key) {
  @if map.has-key($badge-shadows, $key) {
    @return map.get($badge-shadows, $key);
  }

  @error "Badge shadow '#{$key}' not found";
}

/// R√©cup√®re une couleur pastel TSA (depuis _tokens.scss)
/// @param {String} $key - Cl√© de la couleur (blue-light, green-soft, etc.)
/// @return {Color} La couleur demand√©e
@function tsa-pastel($key) {
  // ‚úÖ Lit depuis $tsa-pastel-color-tokens (canonical)
  @if map.has-key($tsa-pastel-color-tokens, $key) {
    @return map.get($tsa-pastel-color-tokens, $key);
  }

  @error "TSA pastel '#{$key}' not found (source: _tokens.scss)";
}

/// R√©cup√®re une ombre/overlay (depuis _tokens.scss)
/// @param {String} $key - Cl√© de l'ombre (black-light, primary-medium, etc.)
/// @return {Color} La couleur d'ombre demand√©e
@function shadow($key) {
  // ‚úÖ Lit depuis $shadow-color-tokens (canonical)
  @if map.has-key($shadow-color-tokens, $key) {
    @return map.get($shadow-color-tokens, $key);
  }

  @error "Shadow '#{$key}' not found (source: _tokens.scss)";
}

/// R√©cup√®re une couleur de marque tierce (depuis _tokens.scss)
/// @param {String} $key - Cl√© de la marque (stripe, stripe-hover, etc.)
/// @return {Color} La couleur demand√©e
@function brand($key) {
  // ‚úÖ Lit depuis $brand-colors (canonical - legacy compatibility)
  @if map.has-key($brand-colors, $key) {
    @return map.get($brand-colors, $key);
  }

  @error "Brand color '#{$key}' not found (source: _tokens.scss)";
}
