@use 'sass:map';
@use './tokens' as *;

// =============================================================================
// SYSTÃˆME DE COULEURS - WRAPPER PUR (100% FONCTIONS)
// =============================================================================
/// âœ… PHASE 2 COMPLÃ‰TÃ‰E (2025-12-14)
///
/// Ce fichier est maintenant un **WRAPPER PUR** :
///   - âŒ AUCUNE dÃ©finition de couleur locale (0 maps)
///   - âœ… UNIQUEMENT des fonctions d'accÃ¨s
///   - âœ… SOURCE DE VÃ‰RITÃ‰ = _tokens.scss (canonical)
///
/// RÃˆGLES STRICTES:
///   1. âŒ JAMAIS dÃ©finir maps de couleurs ici (use _tokens.scss)
///   2. âœ… Fonctions lisent EXCLUSIVEMENT depuis _tokens.scss
///   3. âœ… Validation stricte avec @error si clÃ© invalide
///   4. âœ… Composants utilisent ces fonctions (pas access direct aux maps)
///
/// MIGRATION COMPLÃ‰TÃ‰E:
///   Phase 1 âœ… : Maps migrÃ©es vers _tokens.scss
///   Phase 2 âœ… : Wrapper pur (ce fichier)
///   Phase 3 (SUIVANT) : Migrer composants pour utiliser fonctions tokens
///
/// Usage correct:
///   @use '@styles/abstracts' as *;
///   .my-class { background: color('base'); }          // âœ… Lit $primary-color-tokens
///   .my-class { color: blue(500); }                   // âœ… Lit $blue-palette-tokens
///   .my-class { border-color: semantic('success'); }  // âœ… Lit $semantic-tokens
// =============================================================================

// =============================================================================
// FONCTIONS D'ACCÃˆS - Lisent depuis _tokens.scss (canonical source)
// =============================================================================

/// RÃ©cupÃ¨re une couleur principale (depuis _tokens.scss)
/// @param {String} $key - ClÃ© de la couleur (base, light, dark)
/// @param {String} $type - Type de couleur (primary, secondary, accent)
/// @return {Color} La couleur demandÃ©e
@function color($key, $type: 'primary') {
  // âœ… Lit depuis les tokens canoniques
  $map: $primary-color-tokens;

  @if $type == 'secondary' {
    $map: $secondary-color-tokens;
  } @else if $type == 'accent' {
    $map: $accent-color-tokens;
  }

  @if map.has-key($map, $key) {
    @return map.get($map, $key);
  }

  @error "Color '#{$key}' not found in #{$type} colors (source: _tokens.scss)";
}

/// RÃ©cupÃ¨re une couleur sÃ©mantique (depuis _tokens.scss)
/// @param {String} $name - Nom de la couleur (success, warning, error, info, info-primary)
/// @param {String} $variant - Variante (base, light, dark, bg, border) - dÃ©faut 'base'
/// @return {Color} La couleur demandÃ©e
@function semantic($name, $variant: 'base') {
  // âš ï¸ CompatibilitÃ© : anciennes clÃ©s plates (legacy)
  // 'info-primary' Ã©tait une clÃ© directe dans l'ancien systÃ¨me
  @if $name == 'info-primary' {
    @return #66c3f7; // Valeur legacy pour compatibilitÃ© backward
  }

  // âœ… Lit depuis $semantic-tokens (canonical)
  @if map.has-key($semantic-tokens, $name) {
    $semantic-map: map.get($semantic-tokens, $name);

    @if map.has-key($semantic-map, $variant) {
      @return map.get($semantic-map, $variant);
    }

    @error "Semantic variant '#{$variant}' not found for '#{$name}'. Available: base, light, dark, bg, border (source: _tokens.scss)";
  }

  @error "Semantic color '#{$name}' not found. Available: success, warning, error, info, info-primary (legacy) (source: _tokens.scss)";
}

/// RÃ©cupÃ¨re une nuance de bleu (depuis _tokens.scss)
/// @param {Number} $shade - Nuance (50, 100, 200, ..., 900)
/// @return {Color} La couleur demandÃ©e
@function blue($shade) {
  // âœ… Lit depuis $blue-palette-tokens (canonical)
  @if map.has-key($blue-palette-tokens, $shade) {
    @return map.get($blue-palette-tokens, $shade);
  }

  @error "Blue shade '#{$shade}' not found (source: _tokens.scss)";
}

/// RÃ©cupÃ¨re une nuance de rouge (depuis _tokens.scss)
/// @param {Number} $shade - Nuance (50, 100, 200, ..., 900)
/// @return {Color} La couleur demandÃ©e
@function red($shade) {
  // âœ… Lit depuis $red-palette-tokens (canonical)
  @if map.has-key($red-palette-tokens, $shade) {
    @return map.get($red-palette-tokens, $shade);
  }

  @error "Red shade '#{$shade}' not found (source: _tokens.scss)";
}

/// RÃ©cupÃ¨re une nuance de vert (depuis _tokens.scss)
/// @param {Number} $shade - Nuance (50, 100, 200, ..., 900)
/// @return {Color} La couleur demandÃ©e
@function green($shade) {
  // âœ… Lit depuis $green-palette-tokens (canonical)
  @if map.has-key($green-palette-tokens, $shade) {
    @return map.get($green-palette-tokens, $shade);
  }

  @error "Green shade '#{$shade}' not found (source: _tokens.scss)";
}

/// RÃ©cupÃ¨re une nuance d'orange (depuis _tokens.scss)
/// @param {Number} $shade - Nuance (50, 100, 200, ..., 900)
/// @return {Color} La couleur demandÃ©e
@function orange($shade) {
  // âœ… Lit depuis $orange-palette-tokens (canonical)
  @if map.has-key($orange-palette-tokens, $shade) {
    @return map.get($orange-palette-tokens, $shade);
  }

  @error "Orange shade '#{$shade}' not found (source: _tokens.scss)";
}

/// RÃ©cupÃ¨re une nuance de jaune (depuis _tokens.scss)
/// @param {Number} $shade - Nuance (50, 100, 200, ..., 900)
/// @return {Color} La couleur demandÃ©e
@function yellow($shade) {
  // âœ… Lit depuis $yellow-palette-tokens (canonical)
  @if map.has-key($yellow-palette-tokens, $shade) {
    @return map.get($yellow-palette-tokens, $shade);
  }

  @error "Yellow shade '#{$shade}' not found (source: _tokens.scss)";
}

/// RÃ©cupÃ¨re une nuance de violet (depuis _tokens.scss)
/// @param {Number} $shade - Nuance (50, 100, 200, ..., 900)
/// @return {Color} La couleur demandÃ©e
@function purple($shade) {
  // âœ… Lit depuis $purple-palette-tokens (canonical)
  @if map.has-key($purple-palette-tokens, $shade) {
    @return map.get($purple-palette-tokens, $shade);
  }

  @error "Purple shade '#{$shade}' not found (source: _tokens.scss)";
}

/// RÃ©cupÃ¨re une nuance de slate (depuis _tokens.scss)
/// @param {Number} $shade - Nuance (50, 100, 200, ..., 900)
/// @return {Color} La couleur demandÃ©e
@function slate($shade) {
  // âœ… Lit depuis $slate-palette-tokens (canonical)
  @if map.has-key($slate-palette-tokens, $shade) {
    @return map.get($slate-palette-tokens, $shade);
  }

  @error "Slate shade '#{$shade}' not found (source: _tokens.scss)";
}

/// RÃ©cupÃ¨re une couleur de rÃ´le (CANONICAL - lire depuis _tokens.scss)
/// @param {String} $role - Nom du rÃ´le (admin, abonne, visitor, free, staff)
/// @param {String} $variant - Variante (base, light, dark, gradient-start, gradient-end)
///                            or legacy 'gradient' (alias for 'gradient-start')
/// @return {Color} La couleur demandÃ©e
///
/// âœ… Phase 2 UPDATE: Cette fonction proxe maintenant vers _tokens.$role-color-tokens
///    (source de vÃ©ritÃ© canonical) au lieu de lire la map locale deprecated.
///
/// ğŸ“ Exemples:
///   role-color('admin', 'base') â†’ #667eea (violet)
///   role-color('admin', 'gradient-start') â†’ #667eea
///   role-color('admin', 'gradient-end') â†’ #764ba2
///   role-color('admin', 'gradient') â†’ #667eea (legacy alias, redirects to 'gradient-start')
///
/// âš ï¸ NOTE: La map locale $role-colors est NOW READ-ONLY (deprecated).
@function role-color($role, $variant: 'base') {
  // Legacy alias support: 'gradient' â†’ 'gradient-start'
  $normalized-variant: $variant;
  @if $variant == 'gradient' {
    $normalized-variant: 'gradient-start';
  }

  // CANONICAL SOURCE: _tokens.$role-color-tokens
  @if map.has-key($role-color-tokens, $role) {
    $role-map: map.get($role-color-tokens, $role);

    @if map.has-key($role-map, $normalized-variant) {
      @return map.get($role-map, $normalized-variant);
    }

    @error "Role color variant '#{$normalized-variant}' (requested: '#{$variant}') not found for role '#{$role}'. Available: base, light, dark, gradient-start, gradient-end. See _tokens.scss for canonical values.";
  }

  @error "Role '#{$role}' not found in $role-color-tokens (canonical source in _tokens.scss)";
}

/// RÃ©cupÃ¨re une couleur de texte (depuis _tokens.scss)
/// @param {String} $type - Type de texte (default, invert, light, dark, muted)
/// @return {Color} La couleur demandÃ©e
@function text($type: 'default') {
  // âœ… Lit depuis $text-color-tokens (canonical)
  @if map.has-key($text-color-tokens, $type) {
    @return map.get($text-color-tokens, $type);
  }

  @error "Text color '#{$type}' not found (source: _tokens.scss)";
}

/// RÃ©cupÃ¨re une couleur de surface (depuis _tokens.scss)
/// @param {String} $type - Type de surface (bg, surface, border, soft, hover)
/// @return {Color} La couleur demandÃ©e
@function surface($type) {
  // âœ… Lit depuis $surface-color-tokens (canonical)
  @if map.has-key($surface-color-tokens, $type) {
    @return map.get($surface-color-tokens, $type);
  }

  @error "Surface color '#{$type}' not found (source: _tokens.scss)";
}

/// RÃ©cupÃ¨re une couleur admin UI (depuis _tokens.scss)
/// @param {String} $key - ClÃ© de la couleur (primary, secondary, success, danger, etc.)
/// @return {Color} La couleur demandÃ©e
@function admin-ui($key) {
  // âœ… Lit depuis $admin-ui-color-tokens (canonical)
  @if map.has-key($admin-ui-color-tokens, $key) {
    @return map.get($admin-ui-color-tokens, $key);
  }

  @error "Admin UI color '#{$key}' not found (source: _tokens.scss)";
}

/// RÃ©cupÃ¨re une couleur warning state (depuis _tokens.scss)
/// @param {String} $key - ClÃ© de la couleur (warning, error, warning-bg, etc.)
/// @return {Color} La couleur demandÃ©e
@function warning($key) {
  // âœ… Lit depuis $warning-state-color-tokens (canonical)
  @if map.has-key($warning-state-color-tokens, $key) {
    @return map.get($warning-state-color-tokens, $key);
  }

  @error "Warning state '#{$key}' not found (source: _tokens.scss)";
}

/// RÃ©cupÃ¨re un gradient badge
/// @param {String} $role - Nom du rÃ´le (abonne, free, visitor, admin, staff)
/// @return {Map} Map avec start/end du gradient
@function badge-gradient($role) {
  @if map.has-key($badge-gradients, $role) {
    @return map.get($badge-gradients, $role);
  }

  @error "Badge gradient '#{$role}' not found";
}

/// RÃ©cupÃ¨re un gradient UI moderne
/// @param {String} $name - Nom du gradient (purple-modern, purple-modern-hover, blue-soft)
/// @return {Map} Map avec start/end du gradient
@function ui-gradient($name) {
  @if map.has-key($ui-gradients, $name) {
    @return map.get($ui-gradients, $name);
  }

  @error "UI gradient '#{$name}' not found";
}

/// RÃ©cupÃ¨re une ombre badge
/// @param {String} $role - Nom du rÃ´le + variante (abonne, abonne-hover, etc.)
/// @return {Color} La couleur d'ombre demandÃ©e
@function badge-shadow($key) {
  @if map.has-key($badge-shadows, $key) {
    @return map.get($badge-shadows, $key);
  }

  @error "Badge shadow '#{$key}' not found";
}

/// RÃ©cupÃ¨re une couleur pastel TSA (depuis _tokens.scss)
/// @param {String} $key - ClÃ© de la couleur (blue-light, green-soft, etc.)
/// @return {Color} La couleur demandÃ©e
@function tsa-pastel($key) {
  // âœ… Lit depuis $tsa-pastel-color-tokens (canonical)
  @if map.has-key($tsa-pastel-color-tokens, $key) {
    @return map.get($tsa-pastel-color-tokens, $key);
  }

  @error "TSA pastel '#{$key}' not found (source: _tokens.scss)";
}

/// RÃ©cupÃ¨re une ombre/overlay (depuis _tokens.scss)
/// @param {String} $key - ClÃ© de l'ombre (black-light, primary-medium, etc.)
/// @return {Color} La couleur d'ombre demandÃ©e
@function shadow($key) {
  // âœ… Lit depuis $shadow-color-tokens (canonical)
  @if map.has-key($shadow-color-tokens, $key) {
    @return map.get($shadow-color-tokens, $key);
  }

  @error "Shadow '#{$key}' not found (source: _tokens.scss)";
}

/// RÃ©cupÃ¨re une couleur de marque tierce (depuis _tokens.scss)
/// @param {String} $key - ClÃ© de la marque (stripe, stripe-hover, etc.)
/// @return {Color} La couleur demandÃ©e
@function brand($key) {
  // âœ… Lit depuis $brand-colors (canonical - legacy compatibility)
  @if map.has-key($brand-colors, $key) {
    @return map.get($brand-colors, $key);
  }

  @error "Brand color '#{$key}' not found (source: _tokens.scss)";
}

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// ğŸŒˆ FONCTION GRADIENT - DÃ©gradÃ©s rÃ´les utilisateurs
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
//
// USAGE :
//   gradient($role, $direction: '135deg')
//
// EXEMPLES :
//   background: gradient('admin');              // DÃ©gradÃ© admin 135deg (dÃ©faut)
//   background: gradient('abonne', '90deg');    // DÃ©gradÃ© abonnÃ© horizontal
//   background: gradient('free', 'to bottom');  // DÃ©gradÃ© free vertical
//
// ROLES DISPONIBLES :
//   'admin', 'abonne', 'free', 'visitor', 'staff'
//
// DIRECTIONS :
//   - Angle : '45deg', '90deg', '135deg' (dÃ©faut), '180deg'
//   - Keyword : 'to right', 'to bottom', 'to top', 'to left'
//   - Diagonal : 'to bottom right', 'to top left'
//
// VALIDATION STRICTE :
//   @error si rÃ´le invalide ou clÃ©s gradient manquantes
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

@function gradient($role, $direction: '135deg') {
  // Valider que le rÃ´le existe
  @if not map.has-key($role-color-tokens, $role) {
    @error "Gradient role '#{$role}' not found. Available: #{map.keys($role-color-tokens)}";
  }

  $role-map: map.get($role-color-tokens, $role);

  // Valider que gradient-start existe
  @if not map.has-key($role-map, 'gradient-start') {
    @error "Gradient 'gradient-start' not found for role '#{$role}'. Keys: #{map.keys($role-map)}";
  }

  // Valider que gradient-end existe
  @if not map.has-key($role-map, 'gradient-end') {
    @error "Gradient 'gradient-end' not found for role '#{$role}'. Keys: #{map.keys($role-map)}";
  }

  $start: map.get($role-map, 'gradient-start');
  $end: map.get($role-map, 'gradient-end');

  @return linear-gradient(#{$direction}, $end, $start);
}

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// ğŸŒˆ FONCTION GRADIENT-RADIAL - DÃ©gradÃ©s radiaux (optionnel)
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

@function gradient-radial($role, $shape: 'circle', $position: 'center') {
  @if not map.has-key($role-color-tokens, $role) {
    @error "Gradient role '#{$role}' not found. Available: #{map.keys($role-color-tokens)}";
  }

  $role-map: map.get($role-color-tokens, $role);
  $start: map.get($role-map, 'gradient-start');
  $end: map.get($role-map, 'gradient-end');

  @return radial-gradient(#{$shape} at #{$position}, $start, $end);
}
