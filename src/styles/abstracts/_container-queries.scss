@charset 'UTF-8';
@use 'sass:map';
@use 'tokens' as *;

/// ============================================================================
/// CONTAINER QUERIES - Wrapper pur pour modern responsive design
/// ============================================================================
/// ✅ CONFORME TOKENS-FIRST : Toutes les valeurs proviennent de $container-query-tokens
/// Ce fichier NE DÉFINIT AUCUNE donnée, il expose uniquement des fonctions/mixins wrapper.
///
/// SOURCE DE VÉRITÉ : $container-query-tokens dans _tokens.scss
///
/// Container queries permettent responsive design basé sur taille du conteneur parent
/// plutôt que du viewport - idéal pour composants réutilisables modulaires
///
/// Compatibilité: Chrome 105+, Safari 16+, Firefox 110+
///
/// Usage:
///   .card-grid { @include container(); }         // Définit container
///   .card { @include respond-container('md') }  // Query sur container
///
/// Migration v2.1:
///   - ✅ Supprimé $container-breakpoints (duplication)
///   - ✅ respond-container() lit uniquement depuis $container-query-tokens
///   - ✅ Mixins conservés (container, container-named, container-with-fallback)
/// ============================================================================

/// ============================================================================
/// MIXINS - Container Query Context
/// ============================================================================

/// Définit un élément comme container query context
/// Par défaut, utilise container-type: inline-size (largeur uniquement)
///
/// @param {String} $type - Type de container ('inline-size', 'size', 'normal')
///   - 'inline-size': Queries basées sur largeur uniquement (défaut, plus performant)
///   - 'size': Queries basées sur largeur ET hauteur
///   - 'normal': Pas de container query (restore default)
/// @param {String} $name - Nom optionnel du container (pour cibler spécifiquement)
///
/// @example
///   .card-grid { @include container(); }
///   .sidebar { @include container($type: 'size', $name: 'sidebar'); }
@mixin container($type: 'inline-size', $name: null) {
  @if $name {
    container-name: $name;
  }
  container-type: $type;
}

/// ============================================================================
/// MIXINS - Container Media Queries
/// ============================================================================

/// Crée une container query pour responsive design basé sur le container
/// Fonctionne comme @media mais pour containers (min-width du container)
///
/// @param {Length|String} $min-width - Largeur minimale du container
///   - Si String: clé dans $container-query-tokens ('sm', 'md', 'lg', etc.)
///   - Si Length: valeur directe (400px, 20rem, etc.)
/// @param {String} $container-name - Nom optionnel du container à cibler
///
/// @content - Styles à appliquer quand container >= $min-width
///
/// @example
///   .card {
///     padding: 1rem;
///     @include respond-container('md') { padding: 2rem; }
///   }
///
///   .sidebar-widget {
///     @include respond-container(500px) { display: grid; }
///   }
///
///   .nested-card {
///     @include respond-container('lg', $container-name: 'sidebar') {
///       width: 100%;
///     }
///   }
@mixin respond-container($min-width, $container-name: null) {
  // Résoudre token de breakpoint ou utiliser valeur directe
  $resolved-width: $min-width;

  // Si c'est une string, chercher dans $container-query-tokens
  @if type-of($min-width) == 'string' {
    @if map.has-key($container-query-tokens, $min-width) {
      $resolved-width: map.get($container-query-tokens, $min-width);
    } @else {
      @warn "Container breakpoint '#{$min-width}' not found in $container-query-tokens. Available keys: #{map.keys($container-query-tokens)}. Using value as-is.";
    }
  }

  // Construire container query
  @if $container-name {
    @container #{$container-name} (min-width: #{$resolved-width}) {
      @content;
    }
  } @else {
    @container (min-width: #{$resolved-width}) {
      @content;
    }
  }
}

/// ============================================================================
/// MIXINS - Utility Shortcuts
/// ============================================================================

/// Container avec nom auto-généré basé sur le sélecteur
/// Utile pour éviter conflits de noms dans composants complexes
///
/// @example
///   .my-component {
///     @include container-named();  // container-name: my-component
///   }
@mixin container-named() {
  @at-root {
    #{&} {
      container-name: #{&};
      container-type: inline-size;
    }
  }
}

/// Container avec fallback pour navigateurs non-supportés
/// Utilise @supports pour détecter support container queries
///
/// @param {String} $type - Type de container (inline-size, size)
/// @example
///   .responsive-card {
///     @include container-with-fallback();
///   }
@mixin container-with-fallback($type: 'inline-size') {
  @supports (container-type: inline-size) {
    container-type: $type;
  }

  // Fallback: utiliser width: 100% pour responsive basique
  @supports not (container-type: inline-size) {
    width: 100%;
  }
}

/// ============================================================================
/// GUIDELINES & BEST PRACTICES
/// ============================================================================
/// 1. Préférer container-type: inline-size (largeur) à size (largeur+hauteur)
/// 2. Utiliser @include container() sur le PARENT du composant responsive
/// 3. @include respond-container() s'applique sur les ENFANTS du container
/// 4. Container queries ne remplacent pas @media (utiliser les deux selon besoin)
/// 5. Tester support navigateur avec @supports (container-type: inline-size)
/// 6. Container nommés utiles pour containers imbriqués (éviter ambiguïté)
/// 7. Performance : container queries peuvent être plus performants que @media
/// 8. Mobile-first : commencer sans query, ajouter respond-container pour large
/// 9. Éviter container-type: size sauf besoin précis (moins performant)
/// 10. Documenter containers nommés pour maintenance
///
/// EXEMPLES PRATIQUES :
///
/// --- Card responsive basée sur container ---
/// .card-grid { @include container(); }
/// .card {
///   display: block;
///   @include respond-container('sm') { display: flex; }
/// }
///
/// --- Sidebar avec container nommé ---
/// .sidebar { @include container($name: 'sidebar'); }
/// .sidebar-widget {
///   @include respond-container('md', $container-name: 'sidebar') {
///     // Styles uniquement pour sidebar >= 600px
///   }
/// }
///
/// --- Container avec fallback ---
/// .modern-component { @include container-with-fallback(); }
/// ============================================================================
