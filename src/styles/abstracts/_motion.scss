@charset 'UTF-8';
@use 'sass:map';
@use 'tokens' as *;

/// ============================================================================
/// MOTION SYSTEM - Wrapper pur pour animations et transitions
/// ============================================================================
/// ✅ CONFORME TOKENS-FIRST : Toutes les valeurs proviennent de tokens
/// Ce fichier NE DÉFINIT AUCUNE donnée, il expose uniquement des fonctions wrapper.
///
/// SOURCES DE VÉRITÉ :
///   - $motion-tokens dans _tokens.scss (timing, easing, presets)
///
/// Source de vérité pour toutes les animations, transitions et durations.
/// Garantit accessibilité (prefers-reduced-motion) et cohérence design.
///
/// Optimisé TSA (Troubles Spectre Autistique) :
///   - Max 0.3s pour feedback immédiat (doux, prévisible)
///   - Max 0.5s pour reveals (jamais brusque)
///   - Toutes animations respectent prefers-reduced-motion
///
/// Utilisation:
///   transition: color timing('xs') easing('smooth');
///   animation: fade-in timing('fade') easing('smooth-out') forwards;
///
/// Migration v2.1:
///   - ✅ Supprimé toutes variables individuelles ($transition-xs, etc.)
///   - ✅ Supprimé toutes maps locales ($timing-scale, $easing-scale, $motion-tokens)
///   - ✅ Fonctions lisent uniquement depuis $motion-tokens
/// ============================================================================

/// ============================================================================
/// FUNCTIONS - Accesseurs pour motion
/// ============================================================================

/// Récupère une durée depuis timing scale
/// @param {String} $key - Clé dans timing scale ('xs', 'sm', 'base', 'lg', 'xl', '2xl', 'pop', 'fade', 'spin', etc.)
/// @return {String|Number} Durée d'animation (ex: 0.3s, 2s, 'infinite')
/// @example
///   transition: all timing('base') ease;     // 0.3s
///   animation: fade-in timing('fade') ease;  // 0.3s
///   animation: spin timing('spin') linear infinite; // 1.5s
@function timing($key) {
  $timing-map: map.get($motion-tokens, 'timing');

  @if $timing-map == null {
    @error "Timing map not found in $motion-tokens (looking for key 'timing' in _tokens.scss)";
  }

  $value: map.get($timing-map, $key);

  @if $value == null {
    @error "Timing key '#{$key}' not found. Available: #{map.keys($timing-map)} (from $motion-tokens in _tokens.scss)";
  }

  @return $value;
}

/// Récupère une easing function depuis easing scale
/// @param {String} $key - Clé dans easing scale ('linear', 'smooth', 'ease-in', 'ease-out', 'smooth-pop', etc.)
/// @return {String} Easing function CSS (ease, linear, cubic-bezier(...))
/// @example
///   transition: all 0.3s easing('smooth');        // ease
///   animation: pop 0.4s easing('smooth-pop');     // cubic-bezier(0.34, 1.56, 0.64, 1)
@function easing($key) {
  $easing-map: map.get($motion-tokens, 'easing');

  @if $easing-map == null {
    @error "Easing map not found in $motion-tokens (looking for key 'easing' in _tokens.scss)";
  }

  $value: map.get($easing-map, $key);

  @if $value == null {
    @error "Easing key '#{$key}' not found. Available: #{map.keys($easing-map)} (from $motion-tokens in _tokens.scss)";
  }

  @return $value;
}

/// Récupère un motion preset complet (duration + easing prédéfinis)
/// @param {String} $key - Preset ('quick-feedback', 'state-change', 'standard', 'reveal', 'pop', 'elaborate')
/// @return {Map} Map contenant 'duration' et 'easing'
/// @example
///   $motion: motion-preset('pop');
///   animation: pop-animation map.get($motion, 'duration') map.get($motion, 'easing');
@function motion-preset($key) {
  $preset-map: map.get($motion-tokens, 'preset');

  @if $preset-map == null {
    @error "Preset map not found in $motion-tokens (looking for key 'preset' in _tokens.scss)";
  }

  $value: map.get($preset-map, $key);

  @if $value == null {
    @error "Motion preset '#{$key}' not found. Available: #{map.keys($preset-map)} (from $motion-tokens in _tokens.scss)";
  }

  @return $value;
}

/// ============================================================================
/// MIXINS - Helpers pour transitions courantes
/// ============================================================================

/// Applique une transition standard avec timing/easing personnalisables
/// @param {String|List} $property - Propriété CSS à animer (default: all)
/// @param {String} $timing-key - Clé timing (default: 'base')
/// @param {String} $easing-key - Clé easing (default: 'smooth')
/// @example
///   @include transition(color, 'xs', 'smooth');
///   @include transition((color, background-color), 'sm');
@mixin transition($property: all, $timing-key: 'base', $easing-key: 'smooth') {
  transition: $property timing($timing-key) easing($easing-key);
}

/// Applique un preset motion complet
/// @param {String} $preset - Preset name ('quick-feedback', 'state-change', etc.)
/// @param {String|List} $property - Propriété CSS (default: all)
/// @example
///   @include motion-preset-transition('state-change', color);
@mixin motion-preset-transition($preset, $property: all) {
  $motion: motion-preset($preset);
  transition: $property map.get($motion, 'duration') map.get($motion, 'easing');
}

/// ============================================================================
/// ACCESSIBILITY - Respecte prefers-reduced-motion
/// ============================================================================

/// Réduit les durées si l'utilisateur préfère une motion réduite (WCAG 2.2 AA)
/// À appliquer au :root ou parent container
/// CRITIQUE pour accessibilité TSA : animations réduites à quasi-instantané
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

/// ============================================================================
/// CSS CUSTOM PROPERTIES - Pour accès runtime JavaScript
/// ============================================================================

:root {
  // === Timings standards ===
  --timing-xs: #{timing('xs')};
  --timing-sm: #{timing('sm')};
  --timing-base: #{timing('base')};
  --timing-lg: #{timing('lg')};
  --timing-xl: #{timing('xl')};
  --timing-2xl: #{timing('2xl')};

  // === Easings standards ===
  --easing-linear: #{easing('linear')};
  --easing-smooth: #{easing('smooth')};
  --easing-smooth-in: #{easing('ease-in')};
  --easing-smooth-out: #{easing('ease-out')};
  --easing-smooth-in-out: #{easing('ease-in-out')};
}

/// ============================================================================
/// GUIDELINES & BEST PRACTICES
/// ============================================================================
/// 1. JAMAIS hardcoder durées (0.3s, 200ms, etc.) - utiliser timing($key)
/// 2. JAMAIS hardcoder easing (ease, cubic-bezier...) - utiliser easing($key)
/// 3. Accessibilité: TOUJOURS respecter prefers-reduced-motion (déjà géré)
/// 4. TSA design: Motion < 0.3s pour feedback, < 0.5s pour reveals
/// 5. Cohérence: Utiliser motion-preset() pour patterns répétés
/// 6. Prévisibilité: Animations douces, jamais jarring/chaotic
/// 7. Pour animations nouvelles, ajouter à $motion-tokens dans _tokens.scss
/// 8. Considérer contexte utilisateur (enfants TSA = préférence calme)
///
/// TIMING DISPONIBLES :
///   xs (150ms), sm (200ms), base (300ms), lg (500ms), xl (800ms), 2xl (1200ms)
///   pop, rebond, slide, fade, spin, pulse, shimmer, bounce, shake
///   train-move, station-pop, dash-rail, infinite
///
/// EASING DISPONIBLES :
///   linear, smooth, ease-in, ease-out, ease-in-out
///   smooth-pop, bounce-easy, smooth-out, smooth-in
///
/// PRESETS DISPONIBLES :
///   quick-feedback (150ms ease) - Interactions immédiates
///   state-change (200ms ease) - Hover, focus, active
///   standard (300ms ease) - Motion par défaut
///   reveal (500ms ease-out) - Apparitions subtiles
///   pop (400ms smooth-pop) - Effets playful
///   elaborate (800ms ease-in-out) - Séquences complexes
///
/// EXEMPLES :
///
/// ✅ CORRECT :
///   transition: color timing('xs') easing('smooth');
///   animation: fade-in timing('fade') easing('smooth-out');
///   @include transition(background-color, 'sm', 'ease-out');
///   @include motion-preset-transition('state-change', color);
///
/// ❌ INCORRECT :
///   transition: color 0.3s ease;                       // Hardcodé !
///   animation: fade-in 300ms cubic-bezier(0.25, 1...); // Hardcodé !
///   transition: all 0.2s;                              // Hardcodé !
/// ============================================================================
