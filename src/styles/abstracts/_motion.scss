@charset 'UTF-8';
@use 'sass:map';

/// ============================================================================
/// MOTION SYSTEM - Centralisé
/// ============================================================================
/// Source de vérité pour toutes les animations, transitions et durations.
/// Garantit accessibilité (prefers-reduced-motion) et cohérence design.
///
/// Utilisation:
///   transition: color timing(xs) easing(smooth);
///   animation: fade-in timing(sm) easing(smooth) forwards;
/// ============================================================================

// =============================================================================
// DURéES / TIMINGS - Variables individuelles pour compatibilité
// =============================================================================

/// Timings de transition - appliquées é motion fluide
/// Cohérents avec design system TSA (douceur, prévisibilité)
$transition-xs: 0.15s; // Hyper-rapide (feedback immédiat)
$transition-fast: 0.2s; // Rapide (state change)
$transition-base: 0.3s; // Standard (motion par défaut, WCAG compliant)
$transition-slow: 0.5s; // Lent (flourish, important reveals)
$transition-slower: 0.8s; // Très lent (complex animations)
$transition-slowest: 1.2s; // Max durable pour animations

// =============================================================================
// TIMINGS MAP - Tous les timings disponibles
// =============================================================================

/// Map centralisée contenant toutes les durations d'animation
/// Utilisé pour sélectionner le timing approprié par contexte
$timing-scale: (
  // === Transitions rapides (feedback, state changes) ===
  'xs': 0.15s,
  // 150ms - Immédiate (focus, hover)
  'sm': 0.2s,
  // 200ms - Rapide (color transitions)
  'base': 0.3s,
  // 300ms - Standard (default motion)
  'lg': 0.5s,
  // 500ms - Lent (reveals, transforms)
  'xl': 0.8s,
  // 800ms - Très lent (complex sequences)
  '2xl': 1.2s,

  // 1200ms - Max standard
  // === Animations plus longues (sequences) ===
  'pop': 0.4s,
  // Pop animation scale 1->1.15->1
  'rebond': 0.4s,
  // Rebond effect (scale variation)
  'slide': 0.3s,
  // Slide in/out
  'fade': 0.3s,
  // Fade in/out
  'spin': 1.5s,
  // Continuous spin animation
  'pulse': 2s,
  // Breathing pulse effect
  'shimmer': 2s,
  // Skeleton shimmer effect
  'bounce': 0.6s,
  // Bounce effect
  'shake': 0.3s,

  // Shake/vibration effect
  // === Progress bar specific ===
  'train-move': 2s,
  // Train animation across progress
  'station-pop': 0.4s,
  // Station marker pop
  'dash-rail': 2s,

  // SVG dash animation
  // === Continuous loop durations ===
  'infinite': 'infinite' // For loop animations
);

// =============================================================================
// EASING FUNCTIONS - Courbes d'accélération
// =============================================================================

/// Map des easing functions (timing-function CSS)
/// Cohérentes avec WCAG AA et design TSA (douceur, prévisibilité)
$easing-scale: (
  // === Easings standards ===
  'linear': linear,
  // Constant speed
  'smooth': ease,
  // ease = slow start, fast middle, slow end
  'ease-in': ease-in,
  // Slow start
  'ease-out': ease-out,
  // Slow end (preferred for exits)
  'ease-in-out': ease-in-out,

  // Both sides slow
  // === Cubic-bezier pour plus de contréle ===
  'smooth-pop': cubic-bezier(0.34, 1.56, 0.64, 1),
  // Overshoot for pop
  'bounce-easy': cubic-bezier(0.68, -0.55, 0.265, 1.55),
  // Bounce effect
  'smooth-out': cubic-bezier(0.25, 0.46, 0.45, 0.94),
  // Smooth natural exit
  'smooth-in': cubic-bezier(0.55, 0.055, 0.675, 0.19) // Smooth natural enter
);

// =============================================================================
// MOTION TOKENS (timing + easing combinations)
// =============================================================================

/// Paires timing+easing prédéfinies pour patterns courants
/// Utiliser pour cohérence design maximale
$motion-tokens: (
  // === Feedback rapide (interactions utilisateur) ===
  'quick-feedback': (
      duration: $transition-xs,
      easing: ease,
    ),

  // === état change (hover, focus, active) ===
  'state-change': (
      duration: $transition-fast,
      easing: ease,
    ),

  // === Motion standard (par défaut) ===
  'standard': (
      duration: $transition-base,
      easing: ease,
    ),

  // === Reveal/appear (subtle, smooth) ===
  'reveal': (
      duration: $transition-slow,
      easing: ease-out,
    ),

  // === Pop/bounce (playful, engaging) ===
  'pop': (
      duration: 0.4s,
      easing: cubic-bezier(0.34, 1.56, 0.64, 1),
    ),

  // === Long animation (elaborate sequences) ===
  'elaborate': (
      duration: $transition-slower,
      easing: ease-in-out,
    )
);

// =============================================================================
// FUNCTIONS - Accesseurs pour timings et easings
// =============================================================================

/// Récupère une durée depuis la timing scale
/// @param {String} $key - Clé dans $timing-scale
/// @return {String|Number} Durée d'animation (ex: 0.3s, infinite)
/// @example
///   transition: all timing(base) ease;
///   animation: fade-in timing(sm) ease forwards;
@function timing($key) {
  $value: map.get($timing-scale, $key);
  @if $value == null {
    @error 'Timing key "#{$key}" not found. Available: #{map.keys($timing-scale)}';
  }
  @return $value;
}

/// Récupère une easing function depuis la easing scale
/// @param {String} $key - Clé dans $easing-scale
/// @return {String} Easing function CSS
/// @example
///   transition: all 0.3s #{easing(smooth)};
@function easing($key) {
  $value: map.get($easing-scale, $key);
  @if $value == null {
    @error 'Easing key "#{$key}" not found. Available: #{map.keys($easing-scale)}';
  }
  @return $value;
}

/// Récupère un motion token complet (duration + easing)
/// @param {String} $key - Clé dans $motion-tokens
/// @return {Map} Map contenant duration et easing
/// @example
///   $motion: motion-token(pop);
///   animation: pop-animation #{map.get($motion, duration)} #{map.get($motion, easing)};
@function motion-token($key) {
  $value: map.get($motion-tokens, $key);
  @if $value == null {
    @error 'Motion token "#{$key}" not found. Available: #{map.keys($motion-tokens)}';
  }
  @return $value;
}

// =============================================================================
// ACCESSIBILITY - Respects prefers-reduced-motion
// =============================================================================

/// Réduit les durations si l'utilisateur préfére une motion réduite
/// é appliquer au :root ou parent container
@media (prefers-reduced-motion: reduce) {
  * {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}

// =============================================================================
// CSS CUSTOM PROPERTIES - Pour accès runtime
// =============================================================================

:root {
  // === Timings ===
  --timing-xs: #{$transition-xs};
  --timing-sm: #{$transition-fast};
  --timing-base: #{$transition-base};
  --timing-lg: #{$transition-slow};
  --timing-xl: #{$transition-slower};
  --timing-2xl: #{$transition-slowest};

  // === Easings ===
  --easing-linear: linear;
  --easing-smooth: ease;
  --easing-smooth-in: ease-in;
  --easing-smooth-out: ease-out;
  --easing-smooth-in-out: ease-in-out;
}

// ============================================================================
// GUIDELINES
// ============================================================================
// 1. JAMAIS hardcoder durées (0.3s, 200ms, etc.) - utiliser timing($key)
// 2. JAMAIS hardcoder easing - utiliser easing($key)
// 3. Accessibilité: TOUJOURS respecter prefers-reduced-motion
// 4. TSA design: Motion < 0.4s pour feedback, < 0.8s pour reveals
// 5. Cohérence: Utiliser motion-tokens pour patterns répétés
// 6. Prévisibilité: Animations douces, jamais jarring/chaotic
// 7. Pour animations nouvelles, ajouter à maps (pas hardcode)
// 8. Considérer contexte utilisateur (enfants TSA = préférence calme)
