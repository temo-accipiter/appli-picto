@charset 'UTF-8';
@use 'sass:map';
@use 'tokens' as *;

/// ============================================================================
/// ACCESSIBILITY TOKENS - Wrapper pur pour accessibilité WCAG 2.2 AA + TSA
/// ============================================================================
/// ✅ CONFORME TOKENS-FIRST : Toutes les valeurs proviennent de tokens
/// Ce fichier NE DÉFINIT AUCUNE donnée, il expose uniquement des fonctions wrapper.
///
/// SOURCE DE VÉRITÉ : $a11y-tokens dans _tokens.scss
///
/// Tokens d'accessibilité centralisés pour garantir conformité WCAG 2.2 AA.
/// Utilisé par mixins (touch-target, focus-ring, etc.) et composants.
///
/// Spécificités TSA (Troubles du Spectre Autistique) :
///   - Zones tactiles préférées plus grandes (56px vs 44px minimum WCAG)
///   - Focus rings clairs et prévisibles
///   - Contraste élevé recommandé (7.0 pour enhanced)
///   - Animations réduites au strict minimum
///
/// Usage:
///   min-height: a11y('preferred-touch-target'); // -> 56px
///   outline-width: a11y('focus-ring-width'); // -> 2px
///
/// Migration v2.1:
///   - ✅ Supprimé $a11y-tokens map locale (25 hardcodes éliminés)
///   - ✅ Fonction a11y() lit uniquement depuis $a11y-tokens dans _tokens.scss
///   - ✅ CSS custom properties préservées pour accès runtime JS
/// ============================================================================

// =============================================================================
// ACCESSOR FUNCTION - Récupère un token A11Y
// =============================================================================

/// Récupère une valeur de token d'accessibilité
/// @param {String} $key - Clé dans $a11y-tokens
/// @return {Number|Length} Valeur du token
/// @throws Error si clé inexistante
///
/// @example scss - Usage basique
///   min-height: a11y('preferred-touch-target'); // -> 56px
///   outline-width: a11y('focus-ring-width'); // -> 2px
///   line-height: a11y('line-spacing-min'); // -> 1.5
@function a11y($key) {
  $value: map.get($a11y-tokens, $key);
  @if $value == null {
    @error "A11Y token '#{$key}' not found in $a11y-tokens. Available: #{map.keys($a11y-tokens)} (from _tokens.scss)";
  }
  @return $value;
}

// =============================================================================
// CSS CUSTOM PROPERTIES - Export pour accès runtime JS
// =============================================================================

/// CSS variables pour accès JavaScript et runtime
/// Utile pour :
///   - Vérifications dynamiques de contraste
///   - Ajustements de touch targets en JS
///   - Détection prefers-reduced-motion
:root {
  // === Touch targets ===
  --a11y-min-touch-target: #{a11y('min-touch-target')};
  --a11y-preferred-touch-target: #{a11y('preferred-touch-target')};
  --a11y-optimal-touch-target: #{a11y('optimal-touch-target')};

  // === Focus indicators ===
  --a11y-focus-ring-width: #{a11y('focus-ring-width')};
  --a11y-focus-ring-offset: #{a11y('focus-ring-offset')};

  // === Motion ===
  --a11y-reduced-motion-duration: #{a11y('reduced-motion-duration')};
  --a11y-safe-animation-duration: #{a11y('safe-animation-duration')};
  --a11y-safe-transition-duration: #{a11y('safe-transition-duration')};

  // === Contrast ratios (informational - for JS checks) ===
  --a11y-contrast-min: #{a11y('contrast-min')};
  --a11y-contrast-enhanced: #{a11y('contrast-enhanced')};

  // === Spacing ===
  --a11y-line-spacing-min: #{a11y('line-spacing-min')};
  --a11y-paragraph-spacing-min: #{a11y('paragraph-spacing-min')};
}

// =============================================================================
// GUIDELINES & USAGE NOTES
// =============================================================================
/// 1. JAMAIS définir de données locales - toujours passer par tokens
/// 2. Toujours utiliser a11y() function pour accès tokens
/// 3. Préférer 'preferred-touch-target' (56px) pour enfants TSA
/// 4. Utiliser 'min-touch-target' (44px) uniquement si contraintes d'espace
/// 5. Focus rings doivent toujours être visibles (outline + offset)
/// 6. Animations/transitions : tester avec prefers-reduced-motion
/// 7. Contraste 'enhanced' (7.0) recommandé pour texte important
/// 8. Touch targets s'appliquent à : buttons, links, inputs, interactive elements
/// 9. Mixins (touch-target, focus-ring) doivent utiliser ces tokens
/// 10. Valider accessibilité avec outils (axe, WAVE, Lighthouse)
///
/// TOKENS DISPONIBLES :
///   === Contrast ratios ===
///   - contrast-min (4.5)
///   - contrast-enhanced (7.0)
///   - contrast-large-text (3.0)
///
///   === Touch targets ===
///   - min-touch-target (44px)
///   - preferred-touch-target (56px)
///   - optimal-touch-target (48px)
///
///   === Focus indicators ===
///   - focus-ring-width (2px)
///   - focus-ring-offset (2px)
///   - focus-ring-width-enhanced (3px)
///
///   === Motion ===
///   - reduced-motion-duration (0.01ms)
///   - safe-animation-duration (200ms)
///   - safe-transition-duration (150ms)
///
///   === Spacing ===
///   - line-spacing-min (1.5)
///   - paragraph-spacing-min (1.5em)
///   - letter-spacing-min (0.12em)
///   - word-spacing-min (0.16em)
///
/// EXEMPLES :
///
/// ✅ CORRECT :
///   min-height: a11y('preferred-touch-target');
///   outline: a11y('focus-ring-width') solid var(--color-primary);
///   @include touch-target('preferred'); // Utilise a11y() en interne
///   line-height: a11y('line-spacing-min');
///
/// ❌ INCORRECT :
///   min-height: 44px;                              // Hardcodé !
///   outline: 2px solid var(--color-primary);       // Hardcodé !
///   line-height: 1.5;                              // Hardcodé !
/// ============================================================================
