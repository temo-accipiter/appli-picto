@charset 'UTF-8';
@use 'sass:map';
@use 'tokens' as *;

/// ============================================================================
/// SHADOWS SYSTEM - Wrapper pur pour box-shadow et text-shadow
/// ============================================================================
/// ✅ CONFORME TOKENS-FIRST : Toutes les valeurs proviennent de tokens
/// Ce fichier NE DÉFINIT AUCUNE donnée, il expose uniquement des fonctions wrapper.
///
/// SOURCES DE VÉRITÉ :
///   - $shadow-tokens dans _tokens.scss (ALL shadows)
///
/// Structure hiérarchique des shadows :
///   1. Elevation scale (none → 2xl) : profondeur standardisée
///   2. Card shadows : states interactifs (default, hover, active, disabled)
///   3. Role shadows : badges rôles (admin, abonné, free, visitor)
///   4. Button shadows : states boutons
///   5. Badge shadows : petits éléments
///   6. Input shadows : formulaires + focus rings
///   7. Admin UI shadows : interface admin spécifique
///   8. Modal shadows : overlays et modals
///   9. Text shadows : lisibilité sur images
///
/// Usage:
///   box-shadow: shadow('lg');                    // Elevation simple
///   box-shadow: card-shadow('hover');            // Card state
///   box-shadow: role-shadow('admin', 'default'); // Role badge
///   text-shadow: text-shadow('md');              // Text readability
///
/// Migration v2.1:
///   - ✅ Supprimé toutes variables individuelles ($shadow-xs, etc.)
///   - ✅ Supprimé toutes maps locales ($elevation-shadows, $card-shadows, etc.)
///   - ✅ Fonctions lisent uniquement depuis $shadow-tokens
///   - ✅ Mixins adaptés pour utiliser fonctions
/// ============================================================================

/// ============================================================================
/// FUNCTIONS - Accesseurs pour shadows
/// ============================================================================

/// Récupère une shadow depuis l'elevation scale
/// @param {String} $key - Clé elevation ('none', 'xs', 'sm', 'md', 'lg', 'xl', '2xl', 'default', 'subtle', 'raised', 'floating', 'modal')
/// @return {String} Box-shadow value
/// @example
///   box-shadow: shadow('lg');      // 0 8px 24px rgba(0, 0, 0, 0.2)
///   box-shadow: shadow('modal');   // 0 10px 40px rgba(0, 0, 0, 0.3)
@function shadow($key) {
  $elevation-key: 'elevation-#{$key}';
  $value: map.get($shadow-tokens, $elevation-key);

  @if $value == null {
    @error "Shadow key '#{$key}' not found. Available: none, xs, sm, md, lg, xl, 2xl, default, subtle, raised, floating, modal (from $shadow-tokens in _tokens.scss)";
  }

  @return $value;
}

/// Récupère une card shadow (default ou hover state)
/// @param {String} $state - État de la card ('default', 'hover', 'focus', 'active', 'disabled', 'flat', 'elevated')
/// @return {String} Box-shadow value
/// @example
///   box-shadow: card-shadow('default');  // 0 2px 6px rgba(0, 0, 0, 0.15)
///   &:hover { box-shadow: card-shadow('hover'); }
@function card-shadow($state: 'default') {
  $card-map: map.get($shadow-tokens, 'card');

  @if $card-map == null {
    @error "Card shadow map not found in $shadow-tokens (looking for key 'card')";
  }

  $value: map.get($card-map, $state);

  @if $value == null {
    @error "Card shadow state '#{$state}' not found. Available: #{map.keys($card-map)} (from $shadow-tokens in _tokens.scss)";
  }

  @return $value;
}

/// Récupère une shadow spécifique à un rôle
/// @param {String} $role - Rôle utilisateur ('admin', 'abonne', 'free', 'visitor')
/// @param {String} $state - État ('default', 'hover')
/// @return {String} Box-shadow value
/// @example
///   box-shadow: role-shadow('admin', 'hover');   // 0 0 32px rgba(0, 0, 0, 0.45)
///   box-shadow: role-shadow('abonne', 'default'); // Green glow
@function role-shadow($role, $state: 'default') {
  $role-map: map.get($shadow-tokens, 'role');

  @if $role-map == null {
    @error "Role shadow map not found in $shadow-tokens (looking for key 'role')";
  }

  $specific-role-map: map.get($role-map, $role);

  @if $specific-role-map == null {
    @error "Role '#{$role}' not found in role shadows. Available: #{map.keys($role-map)} (from $shadow-tokens in _tokens.scss)";
  }

  $value: map.get($specific-role-map, $state);

  @if $value == null {
    @error "State '#{$state}' not found for role '#{$role}'. Available: #{map.keys($specific-role-map)} (from $shadow-tokens in _tokens.scss)";
  }

  @return $value;
}

/// Récupère une admin UI shadow
/// @param {String} $key - Type de shadow admin ('default', 'hover', 'panel', 'dropdown', 'modal')
/// @return {String} Box-shadow value
/// @example
///   box-shadow: admin-shadow('dropdown');  // 0 10px 40px rgba(0, 0, 0, 0.3)
@function admin-shadow($key: 'default') {
  $admin-map: map.get($shadow-tokens, 'admin-ui');

  @if $admin-map == null {
    @error "Admin UI shadow map not found in $shadow-tokens (looking for key 'admin-ui')";
  }

  $value: map.get($admin-map, $key);

  @if $value == null {
    @error "Admin shadow key '#{$key}' not found. Available: #{map.keys($admin-map)} (from $shadow-tokens in _tokens.scss)";
  }

  @return $value;
}

/// Récupère une button shadow
/// @param {String} $state - État du button ('default', 'hover', 'active', 'focus', 'disabled')
/// @return {String} Box-shadow value
/// @example
///   &:hover { box-shadow: button-shadow('hover'); }
@function button-shadow($state: 'default') {
  $button-map: map.get($shadow-tokens, 'button');

  @if $button-map == null {
    @error "Button shadow map not found in $shadow-tokens (looking for key 'button')";
  }

  $value: map.get($button-map, $state);

  @if $value == null {
    @error "Button shadow state '#{$state}' not found. Available: #{map.keys($button-map)} (from $shadow-tokens in _tokens.scss)";
  }

  @return $value;
}

/// Récupère une badge/pill shadow
/// @param {String} $state - État ('default', 'hover')
/// @return {String} Box-shadow value
/// @example
///   box-shadow: badge-shadow('default');
@function badge-shadow($state: 'default') {
  $badge-map: map.get($shadow-tokens, 'badge');

  @if $badge-map == null {
    @error "Badge shadow map not found in $shadow-tokens (looking for key 'badge')";
  }

  $value: map.get($badge-map, $state);

  @if $value == null {
    @error "Badge shadow state '#{$state}' not found. Available: #{map.keys($badge-map)} (from $shadow-tokens in _tokens.scss)";
  }

  @return $value;
}

/// Récupère une input/form shadow
/// @param {String} $state - État du form ('default', 'hover', 'focus', 'error', 'disabled')
/// @return {String} Box-shadow value
/// @example
///   &:focus-visible { box-shadow: input-shadow('focus'); }
@function input-shadow($state: 'default') {
  $input-map: map.get($shadow-tokens, 'input');

  @if $input-map == null {
    @error "Input shadow map not found in $shadow-tokens (looking for key 'input')";
  }

  $value: map.get($input-map, $state);

  @if $value == null {
    @error "Input shadow state '#{$state}' not found. Available: #{map.keys($input-map)} (from $shadow-tokens in _tokens.scss)";
  }

  @return $value;
}

/// Récupère une modal/overlay shadow
/// @param {String} $key - Type ('default', 'inner')
/// @return {String} Box-shadow value
/// @example
///   box-shadow: modal-shadow('default');
@function modal-shadow($key: 'default') {
  $modal-map: map.get($shadow-tokens, 'modal');

  @if $modal-map == null {
    @error "Modal shadow map not found in $shadow-tokens (looking for key 'modal')";
  }

  $value: map.get($modal-map, $key);

  @if $value == null {
    @error "Modal shadow key '#{$key}' not found. Available: #{map.keys($modal-map)} (from $shadow-tokens in _tokens.scss)";
  }

  @return $value;
}

/// Récupère une text shadow (pour lisibilité sur images)
/// @param {String} $key - Intensité ('none', 'sm', 'md', 'lg')
/// @return {String} Text-shadow value
/// @example
///   text-shadow: text-shadow('lg');  // 0 4px 8px rgba(0, 0, 0, 0.5)
@function text-shadow($key: 'md') {
  $text-map: map.get($shadow-tokens, 'text');

  @if $text-map == null {
    @error "Text shadow map not found in $shadow-tokens (looking for key 'text')";
  }

  $value: map.get($text-map, $key);

  @if $value == null {
    @error "Text shadow key '#{$key}' not found. Available: #{map.keys($text-map)} (from $shadow-tokens in _tokens.scss)";
  }

  @return $value;
}

/// ============================================================================
/// MIXINS - Helpers pour shadows courants
/// ============================================================================

/// Applique une card shadow avec transition interactive
/// @example
///   .card { @include card-shadow-interactive; }
@mixin card-shadow-interactive {
  box-shadow: card-shadow('default');
  transition: box-shadow timing('xs') easing('smooth');

  &:hover,
  &:focus-within {
    box-shadow: card-shadow('hover');
  }

  &:active {
    box-shadow: card-shadow('active');
  }
}

/// Applique une elevation shadow
/// @param {String} $level - Niveau d'élévation ('xs', 'sm', 'md', 'lg', 'xl', '2xl')
/// @example
///   @include elevated('lg');
@mixin elevated($level: 'md') {
  box-shadow: shadow($level);
}

/// Applique un modal/overlay backdrop shadow
/// @example
///   .modal { @include modal-shadow; }
@mixin modal-shadow {
  box-shadow: shadow('2xl');
}

/// Reset shadow (supprime entièrement)
/// @example
///   .flat { @include shadow-none; }
@mixin shadow-none {
  box-shadow: none;
}

/// ============================================================================
/// CSS CUSTOM PROPERTIES - Pour accès runtime JavaScript
/// ============================================================================

:root {
  // === Elevation shadows ===
  --shadow-xs: #{shadow('xs')};
  --shadow-sm: #{shadow('sm')};
  --shadow-md: #{shadow('md')};
  --shadow-lg: #{shadow('lg')};
  --shadow-xl: #{shadow('xl')};
  --shadow-2xl: #{shadow('2xl')};

  // === Semantic aliases ===
  --shadow-default: #{shadow('default')};
  --shadow-subtle: #{shadow('subtle')};
  --shadow-raised: #{shadow('raised')};
  --shadow-floating: #{shadow('floating')};
  --shadow-modal: #{shadow('modal')};
}

/// ============================================================================
/// GUIDELINES & BEST PRACTICES
/// ============================================================================
/// 1. JAMAIS hardcoder box-shadow - utiliser shadow($key) ou card-shadow()
/// 2. Utiliser elevation system pour hiérarchie (xs > sm > md > lg > xl > 2xl)
/// 3. Shadows renforcent hiérarchie visuelle - cohérent avec z-index
/// 4. Role-specific shadows pour distinction admin/abonné/free/visitor
/// 5. Ajouter transition au hover (shadow('default') → shadow('hover'))
/// 6. Input focus: utiliser input-shadow('focus') pour accessibilité
/// 7. Modal/overlay: toujours utiliser shadow('2xl') ou modal-shadow()
/// 8. Performance: Ombres peuvent coûter en perf - limiter animations
/// 9. Couleur shadow: noir (neutral) ou accent (colored emphasis)
/// 10. Pour nouvelles ombres, ajouter à $shadow-tokens dans _tokens.scss
/// 11. Respecter contraste (ombre ne doit pas réduire lisibilité)
///
/// EXEMPLES :
///
/// ✅ CORRECT :
///   .card { box-shadow: card-shadow('default'); }
///   .button { box-shadow: button-shadow('default'); }
///   .modal { box-shadow: modal-shadow('default'); }
///   .badge { box-shadow: badge-shadow('default'); }
///
/// ❌ INCORRECT :
///   .card { box-shadow: 0 2px 6px rgba(0,0,0,0.15); }  // Hardcodé !
///   .button { box-shadow: 0 4px 12px #000; }            // Hardcodé !
///   .modal { box-shadow: 0 10px 40px black; }           // Hardcodé !
/// ============================================================================
