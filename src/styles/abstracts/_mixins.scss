@use 'variables' as *;
/// Applique une version foncée d’une couleur au hover
/// @param {Color} $color Couleur de base
/// @param {Number} $amount Pourcentage de fonçage (par défaut 10%)
@use 'sass:color';

/// ==============================================
///  MIXINS UTILES POUR DESIGN MODULAIRE ET RÉACTIF
/// ==============================================

@mixin hover-darken($color, $amount: 10%) {
  &:hover {
    background-color: color.adjust($color, $lightness: -$amount);
  }
}

/// Générateur de media query (mobile-first)
/// @param {String} $breakpoint sm | md | lg | xl
@mixin respond-to($breakpoint) {
  @if $breakpoint == sm {
    @media (min-width: $breakpoint-sm) {
      @content;
    }
  } @else if $breakpoint == md {
    @media (min-width: $breakpoint-md) {
      @content;
    }
  } @else if $breakpoint == lg {
    @media (min-width: $breakpoint-lg) {
      @content;
    }
  } @else if $breakpoint == xl {
    @media (min-width: $breakpoint-xl) {
      @content;
    }
  }
}

/// ============================================
/// RÈGLE MOBILE-FIRST APPLI-PICTO
/// ============================================
/// TOUJOURS utiliser respond-to() avec min-width
/// JAMAIS utiliser max-width (desktop-first interdit)
/// Breakpoints : sm (576px) | md (768px) | lg (1024px) | xl (1280px)
/// ============================================

/// Clearfix pour les éléments flottants
@mixin clearfix {
  &::after {
    content: '';
    display: block;
    clear: both;
  }
}

/// Centre un conteneur en flex
@mixin flex-center {
  display: flex;
  justify-content: center;
  align-items: center;
}

/// Applique un style sur l'élément et ses états focus/hover/active
/// @param {Boolean} $self Si true, inclut aussi la règle de base (&)
@mixin on-event($self: false) {
  @if $self {
    &,
    &:hover,
    &:active,
    &:focus,
    &:focus-within {
      @content;
    }
  } @else {
    &:hover,
    &:active,
    &:focus,
    &:focus-within {
      @content;
    }
  }
}

/// Applique un focus state accessible (TSA-friendly)
/// @param {Color} $color Couleur du focus (défaut: primary)
@mixin focus-accessible($color: $color-primary) {
  &:focus-visible {
    outline: rem(2) solid $color;
    outline-offset: rem(2);
    @content;
  }
}

/// Focus ring unifié pour tous les éléments interactifs (WCAG 2.2 AA)
/// Utilise $color-accent par défaut pour une cohérence visuelle
/// @param {Color} $color Couleur du ring (défaut: $color-accent)
/// @param {Number} $width Épaisseur du ring (défaut: 2px)
/// @param {Number} $offset Offset du ring (défaut: 2px)
@mixin focus-ring($color: $color-accent, $width: 2px, $offset: 2px) {
  &:focus {
    outline: none; // Reset pour éviter double outline
  }

  &:focus-visible {
    outline: $width solid $color;
    outline-offset: $offset;
  }
}

/// Cible un composant lorsqu’il est à l’intérieur d’un contexte donné
/// @param {String} $context Sélecteur du contexte parent
@mixin when-inside($context) {
  #{$context} & {
    @content;
  }
}

/// Applique une transition douce générique
@mixin transition-smooth {
  transition: all $transition-base ease-in-out;
}

/// Style de base pour une carte ou un conteneur avec fond
@mixin card-style {
  background-color: var(--color-surface);
  color: var(--color-text);
  border-radius: $radius-md;
  box-shadow: $box-shadow;
  padding: $spacing-md;
}

/// Cache visuellement un élément (accessibilité)
@mixin visually-hidden {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  overflow: hidden;
  clip: rect(0, 0, 0, 0);
  white-space: nowrap;
  border: 0;
}

/// Transition sécurisée respectant prefers-reduced-motion (WCAG 2.3.3)
/// Important pour les utilisateurs TSA sensibles aux mouvements
@mixin safe-transition(
  $property: all,
  $duration: $transition-fast,
  $easing: ease
) {
  transition: $property $duration $easing;

  @media (prefers-reduced-motion: reduce) {
    transition: none;
  }
}

/// Animation sécurisée respectant prefers-reduced-motion
@mixin safe-animation(
  $name,
  $duration: $transition-base,
  $timing: ease-in-out
) {
  animation: $name $duration $timing;

  @media (prefers-reduced-motion: reduce) {
    animation: none;
  }
}

/// Zone interactive minimum WCAG 2.2 AA (44x44px)
@mixin interactive-target {
  min-height: rem(44);
  min-width: rem(44);
}

// ============================================
// DND PATTERNS MIXINS (Drag & Drop)
// ============================================

/// Mixin pour zones droppables (DndSlot)
/// Gère les états : default, over, dragging-from
/// @param {Color} $border-color Couleur border au hover
/// @param {Color} $bg-color Couleur background au hover
/// @param {Length} $min-height Hauteur min de la zone
/// @example
///   @include dnd-slot($color-primary, rgba($color-primary, 0.08))
@mixin dnd-slot(
  $border-color: var(--color-primary, #4a90d9),
  $bg-color: rgba(74, 144, 217, 0.08),
  $min-height: 140px
) {
  min-height: $min-height;
  border: 2px dashed transparent;
  border-radius: $radius-md;
  background-color: transparent;
  padding: $spacing-sm;
  @include safe-transition(border-color opacity, $transition-fast, ease);

  // État : drag hover (over)
  &.dnd-slot--over,
  &--over {
    border-color: $border-color;
    background-color: $bg-color;
  }

  // État : dragging from this slot
  &.dnd-slot--dragging-from,
  &--dragging-from {
    border-color: $border-color;
    background-color: rgba($border-color, 0.04);
  }

  // Focus visible pour keyboard navigation
  &:focus-visible {
    outline: 2px solid $border-color;
    outline-offset: -2px;
  }
}

/// Mixin pour grille DnD responsive (DndGrid)
/// Grille mobile-first avec auto-fill
/// @param {Length} $min-width Largeur min items (minmax)
/// @param {Length} $gap Gap entre items
/// @example
///   @include dnd-grid(260px, var(--spacing-md))
@mixin dnd-grid($min-width: 260px, $gap: var(--spacing-md)) {
  display: grid;
  grid-auto-flow: dense;

  // Mobile par défaut (320px-767px)
  grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
  gap: var(--spacing-xs);

  // Tablette (768px+)
  @media (min-width: 768px) {
    grid-template-columns: repeat(auto-fill, minmax($min-width, 1fr));
    gap: var(--spacing-sm);
  }

  // Desktop (1024px+)
  @media (min-width: 1024px) {
    gap: $gap;
  }

  // État dragging global
  &.dnd-grid--dragging {
    opacity: 0.95;
  }
}

/// Alias pour dnd-layout (compatibilité future)
@mixin dnd-layout {
  @include dnd-grid;
}
