// src/components/features/time-timer/TimeTimer.scss
// Styles Time Timer (TSA-friendly : pastel, calm, prévisible)
@use '@styles/abstracts' as *;

// ============================================================================
// TIME TIMER COMPONENT
// ============================================================================
// ✅ PHASE 6 VALIDÉ : Wrappers spacing/semantic/radius/shadow/timing/surface avec fallback
//    - spacing('xl'/'lg'/'md'/'xs'/'sm'/'80') → Primitives Phase 6 ✅
//    - semantic('info'/'success'/'warning'/'error', all variants) → Semantics Phase 6 ✅
//    - radius('lg'/'md'/'sm') → Primitives Phase 6 (20px/12px/6px) ✅
//    - shadow('elevation-sm'/'elevation-md'/'elevation-xs') → Primitives Phase 6 ✅
//    - timing('base'/'fast') → Primitives Phase 6 (0.2s/0.15s) ✅
//    - easing('smooth') → Primitives Phase 6 ✅
//    - surface('bg'/'soft'/'border') → Semantics Phase 6 ✅
//    - text('default'/'invert'/'light') → Semantics Phase 6 ✅
//    - safe-transition() → Mixin Phase 6 ✅
//    - when-inside() → Mixin Phase 6 ✅
//    - non-invasive-focus() → Mixin Phase 6 ✅
//    - visually-hidden → Mixin Phase 6 ✅
//    - respond-to() → Mixin responsive Phase 6 ✅
//    - size('600'/'300'/'280'/'160') → Legacy support actif
//    - font-size('5xl'/'xl'/'sm'/'lg'/'base') → Legacy support actif
//    - font-weight('bold'/'medium'/'semibold') → Legacy support actif
//    - line-height('none') → Legacy support actif
//    - border-width('base') → Legacy support actif
//    - opacity('0-95'/'half') → Legacy support actif
// ============================================================================

/* Component Styles */
.time-timer {
  /* Layout & Spacing */
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: spacing('xl');
  padding: spacing('xl');

  /* Appearance - Fond bleu avec bordure noire (Time Timer physique) */
  background: semantic('info', 'bg');
  border: size('4') solid text('dark'); // Bordure noire épaisse
  border-radius: radius('lg');
  box-shadow: shadow('elevation-lg'); // Ombre portée pour effet 3D

  /* Modifiers (BEM) */

  /* Mode plein écran */
  &--full {
    min-height: size('600');
    max-width: size('600');
    margin: 0 auto;
  }

  /* Mode compact */
  &--compact {
    //max-width: size('300');
    padding: spacing('lg');
    gap: spacing('md');
  }

  /* Elements (BEM) */

  &__circle-container {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    max-width: 100%;
    @include when-inside('.time-timer--compact') {
      max-width: 100%;
    }
  }

  &__circle {
    width: 100%;
    height: auto;
    filter: drop-shadow(shadow('elevation-xs'));
  }

  &__circle-bg {
    /* Cercle de fond blanc avec bordure noire */
  }

  &__red-disk {
    /* Disque rouge secteur circulaire (temps restant) */
    @include safe-transition(opacity, timing('base'), easing('smooth'));
  }

  &__number {
    /* Numéros autour du cadran */
    user-select: none;
    pointer-events: none;
  }

  &__time-display {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: spacing('xs');
    text-align: center;
  }

  &__time-text {
    font-size: font-size('5xl');
    font-weight: font-weight('bold');
    color: text('default');
    line-height: line-height('none');
    font-variant-numeric: tabular-nums;

    @include when-inside('.time-timer--compact') {
      font-size: font-size('xl');
    }
  }

  &__duration-label {
    font-size: font-size('sm');
    color: text('light');
    font-weight: font-weight('medium');
  }

  &__controls {
    display: flex;
    gap: spacing('md');
    flex-wrap: wrap;
    justify-content: center;
  }

  &__btn {
    display: flex;
    align-items: center;
    gap: spacing('xs');
    padding: spacing('md') spacing('lg');
    border: none;
    border-radius: radius('md');
    font-size: font-size('base');
    font-weight: font-weight('semibold');
    cursor: pointer;
    @include safe-transition(all, timing('base'), easing('smooth'));
    box-shadow: shadow('elevation-sm');

    @include when-inside('.time-timer--compact') {
      padding: spacing('sm') spacing('md');
      font-size: font-size('sm');
    }

    /* Interactive States */
    &:hover:not(:disabled) {
      transform: translateY(-0.125rem);
      box-shadow: shadow('elevation-md');
    }

    &:active:not(:disabled) {
      transform: translateY(0);
      box-shadow: shadow('elevation-sm');
    }

    &:disabled {
      opacity: opacity('half');
      cursor: not-allowed;
    }

    /* A11y Focus */
    @include non-invasive-focus(semantic('info-primary'));

    /* Variant: Primary */
    &--primary {
      background: semantic('info-primary');
      color: text('invert');

      &:hover:not(:disabled) {
        background: semantic('info', 'dark');
      }
    }

    /* Variant: Secondary */
    &--secondary {
      background: surface('bg');
      color: text('default');
      border: border-width('base') solid surface('border');

      &:hover:not(:disabled) {
        background: surface('soft');
        border-color: semantic('info', 'border');
      }
    }
  }

  &__icon {
    font-size: font-size('lg');
    line-height: line-height('none');

    @include when-inside('.time-timer--compact') {
      font-size: font-size('base');
    }
  }

  /* Settings Modal */

  &__settings-modal {
    display: flex;
    flex-direction: column;
    gap: spacing('xl');
  }

  &__settings-section {
    display: flex;
    flex-direction: column;
    gap: spacing('md');
  }

  &__settings-subtitle {
    margin: 0;
    font-size: font-size('md');
    font-weight: font-weight('semibold');
    color: text('default');
  }

  &__settings-hint {
    margin: 0;
    font-size: font-size('sm');
    color: text('light');
    line-height: line-height('relaxed');

    /* Variant info (message d'information) */
    &--info {
      color: semantic('info-primary');
      font-weight: font-weight('medium');
      padding: spacing('sm') spacing('md');
      background: semantic('info', 'bg');
      border-radius: radius('sm');
      border-left: size('4') solid semantic('info-primary');
    }
  }

  &__checkbox-label {
    display: flex;
    align-items: center;
    gap: spacing('md');
    cursor: pointer;
    padding: spacing('md');
    border-radius: radius('md');
    @include safe-transition(background, timing('fast'), easing('smooth'));

    &:hover {
      background: surface('soft');
    }

    /* État désactivé (disabled) */
    &--disabled {
      opacity: opacity('half');
      cursor: not-allowed;

      &:hover {
        background: transparent; // Pas de hover quand disabled
      }

      .time-timer__checkbox {
        cursor: not-allowed;
      }

      .time-timer__checkbox-text {
        color: text('light'); // Texte grisé
      }
    }
  }

  &__checkbox {
    width: size('icon-md');
    height: size('icon-md');
    cursor: pointer;
  }

  &__checkbox-text {
    font-size: font-size('base');
    font-weight: font-weight('medium');
    color: text('default');
  }

  &__preset-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(spacing('80'), 1fr));
    gap: spacing('sm');

    @include when-inside('.time-timer--compact') {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  &__preset-btn {
    padding: spacing('md');
    border: border-width('base') solid surface('border');
    border-radius: radius('sm');
    background: surface('bg');
    color: text('default');
    font-size: font-size('base');
    font-weight: font-weight('medium');
    cursor: pointer;
    @include safe-transition(all, timing('fast'), easing('smooth'));

    &:hover {
      background: surface('soft');
      border-color: semantic('info', 'border');
      transform: translateY(-0.125rem);
    }

    &:active {
      transform: translateY(0);
    }

    @include non-invasive-focus(semantic('info-primary'));

    &--active {
      background: semantic('info-primary');
      color: text('invert');
      border-color: transparent;
      font-weight: font-weight('bold');
      animation: pop timing('base') easing('smooth');

      &:hover {
        background: semantic('info', 'dark');
      }
    }
  }

  /* Color Picker */
  &__color-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: spacing('md');

    @include respond-to('mobile') {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  &__color-btn {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: spacing('xs');
    padding: spacing('md');
    border: border-width('base') solid surface('border');
    border-radius: radius('md');
    background: surface('bg');
    cursor: pointer;
    @include safe-transition(all, timing('fast'), easing('smooth'));

    &:hover {
      background: surface('soft');
      border-color: semantic('info', 'border');
      transform: translateY(-0.125rem);
    }

    &:active {
      transform: translateY(0);
    }

    @include non-invasive-focus(semantic('info-primary'));

    &--selected {
      border-color: semantic('info-primary');
      border-width: border-width('thick');
      background: semantic('info', 'bg');
    }
  }

  &__color-swatch {
    width: size('40');
    height: size('40');
    border-radius: radius('full');
    border: border-width('base') solid surface('border');
  }

  &__color-label {
    font-size: font-size('sm');
    font-weight: font-weight('medium');
    color: text('default');
  }

  /* Size Selector */
  &__size-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: spacing('md');

    @include respond-to('mobile') {
      grid-template-columns: 1fr;
    }
  }

  &__size-btn {
    padding: spacing('md');
    border: border-width('base') solid surface('border');
    border-radius: radius('md');
    background: surface('bg');
    color: text('default');
    font-size: font-size('base');
    font-weight: font-weight('medium');
    cursor: pointer;
    @include safe-transition(all, timing('fast'), easing('smooth'));

    &:hover {
      background: surface('soft');
      border-color: semantic('info', 'border');
      transform: translateY(-0.125rem);
    }

    &:active {
      transform: translateY(0);
    }

    @include non-invasive-focus(semantic('info-primary'));

    &--selected {
      background: semantic('info-primary');
      color: text('invert');
      border-color: transparent;
      font-weight: font-weight('bold');

      &:hover {
        background: semantic('info', 'dark');
      }
    }
  }

  /* Custom Durations */
  &__custom-durations {
    display: flex;
    flex-direction: column;
    gap: spacing('md');
  }

  &__custom-input-wrapper {
    display: flex;
    gap: spacing('sm');
  }

  &__custom-input {
    flex: 1;
    padding: spacing('md');
    border: border-width('base') solid surface('border');
    border-radius: radius('md');
    background: surface('bg');
    color: text('default');
    font-size: font-size('base');
    @include safe-transition(border-color, timing('fast'), easing('smooth'));

    &:hover {
      border-color: semantic('info', 'border');
    }

    &:focus {
      outline: none;
      border-color: semantic('info-primary');
      box-shadow: shadow('elevation-sm');
    }
  }

  &__add-custom-btn {
    padding: spacing('md') spacing('lg');
    border: none;
    border-radius: radius('md');
    background: semantic('info-primary');
    color: text('invert');
    font-size: font-size('base');
    font-weight: font-weight('semibold');
    cursor: pointer;
    @include safe-transition(all, timing('fast'), easing('smooth'));

    &:hover {
      background: semantic('info', 'dark');
      transform: translateY(-0.125rem);
    }

    &:active {
      transform: translateY(0);
    }

    @include non-invasive-focus(semantic('info-primary'));
  }

  &__custom-duration-list {
    display: flex;
    flex-wrap: wrap;
    gap: spacing('sm');
  }

  &__custom-duration-item {
    display: flex;
    align-items: center;
    gap: spacing('xs');
    padding: spacing('sm') spacing('md');
    border: border-width('base') solid surface('border');
    border-radius: radius('full');
    background: surface('soft');
    font-size: font-size('sm');
    font-weight: font-weight('medium');
    color: text('default');
  }

  &__remove-custom-btn {
    display: flex;
    align-items: center;
    justify-content: center;
    width: size('icon-sm');
    height: size('icon-sm');
    padding: 0;
    border: none;
    border-radius: radius('full');
    background: transparent;
    color: text('light');
    cursor: pointer;
    @include safe-transition(all, timing('fast'), easing('smooth'));

    &:hover {
      background: semantic('error', 'light');
      color: semantic('error', 'dark');
    }

    &:active {
      transform: scale(0.95);
    }

    @include non-invasive-focus(semantic('error'));
  }

  /* Timer Size Variations */
  &--small {
    .time-timer__circle-container {
      max-width: size('200');
    }

    .time-timer__time-text {
      font-size: font-size('3xl');
    }

    .time-timer__duration-label {
      font-size: font-size('xs');
    }
  }

  &--large {
    .time-timer__circle-container {
      max-width: size('320');
    }

    .time-timer__time-text {
      font-size: font-size('6xl');
    }

    .time-timer__duration-label {
      font-size: font-size('base');
    }
  }
}

/* Utility class */
.sr-only {
  @include visually-hidden;
}

/* Runtime exports pour JS (React) - colorer le SVG */
:root {
  --color-success: #{semantic('success', 'base')};
  --color-warning: #{semantic('warning', 'base')};
  --color-danger: #{semantic('error', 'base')};
  --color-gray-light: #{surface('border')};

  /* Disk colors for Time Timer */
  --disk-color-red: #{red(500)};
  --disk-color-blue: #{blue(500)};
  --disk-color-green: #{green(500)};
  --disk-color-purple: #{purple(500)};
}

/* Accessibility (Reduced Motion) */
@media (prefers-reduced-motion: reduce) {
  .time-timer {
    &__red-disk,
    &__btn,
    &__preset-btn {
      transition: none;
    }

    &__btn:hover:not(:disabled),
    &__preset-btn:hover {
      transform: none;
    }

    &__preset-btn--active,
    &__settings {
      animation: none;
    }
  }
}
