// src/components/features/taches/taches-dnd/TachesDnd.scss
// Styles drag & drop tâches (TSA-friendly : pastel, calm)
@use '@styles/abstracts' as *;

// ============================================================================
// TACHES DND COMPONENT
// ============================================================================
// ✅ PHASE 6 VALIDÉ : Wrappers size/spacing/radius/semantic/shadow/timing avec fallback
//    - size('100'/'200'/'160'/'16'/'20') → Legacy support actif
//    - spacing('sm'/'md'/'xs'/'32'/'300'/'260') → Primitives Phase 6 ✅
//    - radius('md'/'sm'/'full') → Primitives Phase 6 (12px/6px/50%) ✅
//    - semantic('info', all variants) → Semantics Phase 6 ✅
//    - shadow('elevation-sm'/'elevation-md'/'elevation-lg') → Primitives Phase 6 ✅
//    - surface('bg') → Semantics Phase 6 ✅
//    - text('invert') → Semantics Phase 6 (#ffffff) ✅
//    - timing('base'/'slow'/'fast') → Primitives Phase 6 (0.2s/0.5s/0.15s) ✅
//    - easing('smooth'/'spring') → Primitives Phase 6 ✅
//    - safe-transition() → Mixin Phase 6 ✅
//    - respond-to() → Mixin responsive Phase 6 ✅
//    - border-width('medium'/'thick') → Legacy support actif
//    - font-size('sm'/'lg'/'xs') → Legacy support actif
//    - font-weight('bold') → Legacy support actif
//    - opacity('half'/'0-6'/'lg') → Legacy support actif
//    - z-index('dropdown') → Legacy support actif
// ============================================================================

.grid-taches {
  display: grid;
  width: 100%;
  position: relative;
  overflow: visible; /* Permet aux images de dépasser lors du hover */

  /* [Mobile-first] Base = mobile (320px+) */
  grid-template-columns: repeat(auto-fill, minmax(size('100'), 1fr));
  gap: spacing('sm');
  padding: spacing('sm');

  /* Desktop (576px+) */
  @include respond-to(sm) {
    grid-template-columns: repeat(auto-fill, minmax(size('200'), 1fr));
    gap: spacing('md');
    padding: spacing('md');
  }

  /* Isolation pour éviter les effets de bord sur les z-index */
  isolation: isolate;
}

.slot {
  min-height: size('160');
  border: border-width('medium') dashed transparent;
  border-radius: radius('md');
  overflow: visible; /* Permet à l'image de dépasser lors du hover */
  @include safe-transition(
    (border-color, background-color),
    timing('base'),
    easing('smooth')
  );

  /* Slot survolé pendant un drag */
  &.over {
    border-color: semantic('info-primary');
    background: semantic('info', 'bg');
  }

  /* Slot source (d'où vient la carte draggée) */
  &.dragging-from {
    border-color: semantic('info-primary');
    background: semantic('info', 'bg');
    opacity: opacity('half');
  }
}

.card-tache {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: space-between;
  background: semantic('info', 'bg');
  border-radius: radius('md');
  text-align: center;
  box-shadow: shadow('elevation-sm');
  gap: spacing('xs');
  transform: scale(1);

  /* [Mobile-first] Base = mobile (320px+) */
  height: auto;
  min-height: initial;
  padding: spacing('xs');
  @include safe-transition(
    (transform, box-shadow),
    timing('slow'),
    easing('spring')
  );

  /* Hover uniquement */
  &:hover {
    transform: scale(1.05);
    box-shadow: shadow('elevation-md');
    z-index: z-index('dropdown');
  }

  /* Focus visible accessible (WCAG 2.4.7) */
  &:focus-visible {
    outline: border-width('thick') solid semantic('info-primary');
    outline-offset: border-width('thick');
  }

  span {
    font-weight: font-weight('bold');
    flex-grow: 0;

    /* [Mobile-first] Base = mobile */
    font-size: font-size('sm');
  }

  img {
    max-width: 100%;
    max-height: 100%;
    object-fit: contain;
    flex-shrink: 1;

    /* [Mobile-first] Base = mobile */
    width: spacing('32');
    height: spacing('32');
  }

  input[type='checkbox'] {
    appearance: none;
    border: border-width('medium') solid semantic('info-primary');
    background: surface('bg');
    border-radius: radius('sm');
    flex-shrink: 0;
    cursor: pointer;
    position: relative;
    @include safe-transition(background, timing('fast'), easing('smooth'));

    /* [Mobile-first] Base = mobile */
    width: size('16');
    height: size('16');

    &:checked {
      background: semantic('info-primary');
    }

    &:checked::after {
      content: '✔️';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -60%);
      color: text('invert');

      /* [Mobile-first] Base = mobile */
      font-size: font-size('xs');
    }
  }

  &.done {
    opacity: opacity('0-6');
    filter: grayscale(80%);
    text-decoration: line-through;
  }

  &.dragging {
    box-shadow: shadow('elevation-lg');
    opacity: opacity('lg');
  }

  /* Desktop (576px+) */
  @include respond-to(sm) {
    height: spacing('300');
    min-height: spacing('260');
    padding: spacing('sm');

    span {
      font-size: font-size('lg');
    }

    img {
      width: auto;
      height: auto;
    }

    input[type='checkbox'] {
      width: size('20');
      height: size('20');

      &:checked::after {
        font-size: font-size('sm');
      }
    }
  }
}

.drag-overlay-wrapper {
  /* Style pour l'élément en cours de drag */
  cursor: grabbing;

  /* Ombre plus prononcée pour l'effet de levée */
  filter: drop-shadow(shadow('elevation-md'));

  /* Légère rotation pour l'effet de soulèvement */
  transform: rotate(3deg) scale(1.05);
  @include safe-transition(transform, timing('fast'), easing('spring'));
}

.reset-all-zone {
  text-align: center;
  margin-top: spacing('md');
}
