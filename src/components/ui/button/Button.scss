// src/components/ui/button/Button.scss
@use '@styles/abstracts' as *;

/// ============================================================================
/// BUTTON COMPONENT - Tokens-First
/// ============================================================================
/// Composant bouton atomique réutilisable avec variants
/// - Primary, Secondary, Default, Danger
/// - Loading state avec spinner
/// - WCAG 2.2 AA compliant (44px touch target, focus visible)
/// - TSA-friendly animations (≤ 0.3s, prefers-reduced-motion)
///
/// ✅ CONFORME TOKENS-FIRST : Toutes valeurs via fonctions tokens
/// ✅ PHASE 6 VALIDÉ : Wrappers spacing/radius/surface/text/semantic avec fallback
///    - spacing('xs'/'sm'/'6') → Primitives Phase 6 (4px/8px/6px) ✅
///    - radius('sm'/'full') → Primitives Phase 6 (6px/50%) ✅
///    - surface('surface'/'hover') → Semantics Phase 6 ✅
///    - text('invert') → Semantics Phase 6 (#ffffff) ✅
///    - semantic('error', variants) → Semantics Phase 6 ✅
///    - color('base'/'dark'/'secondary') → Legacy support actif
///    - shadow('elevation-sm') → Legacy support actif
/// ============================================================================

// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// BUTTON BASE
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

.btn {
  // Layout
  display: inline-flex;
  align-items: center;
  justify-content: center;

  // Spacing
  padding: spacing('xs') spacing('sm');

  // Apparence
  border: none;
  border-radius: radius('sm'); // 4px - Slightly rounded
  box-shadow: shadow('elevation-sm'); // ✅ 0 2px 6px rgba(0, 0, 0, 0.15)

  // Typographie
  font-family: var(--font-tsa);
  font-weight: font-weight('semibold');
  font-size: font-size('base');
  line-height: line-height('tight'); // 1.2

  // Accessibilité WCAG AA
  @include touch-target('min'); // 44px min-height/width

  // UX
  cursor: pointer;
  @include safe-transition(background color, timing('fast'), easing('smooth'));

  // Focus WCAG 2.2 AA
  @include focus-ring;

  // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  // ELEMENTS
  // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  &__text {
    display: inline-block;
  }

  // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  // VARIANTS
  // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  &--default {
    background-color: surface('surface');
    color: text();

    @include on-event {
      background-color: surface('hover'); // gray(200) → token sémantique
    }
  }

  &--secondary {
    background-color: color('base', 'secondary');
    color: text('invert');

    @include on-event {
      background-color: color(
        'dark',
        'secondary'
      ); // ✅ Variant ajouté dans _tokens.scss Phase 6
    }
  }

  &--primary {
    // WCAG 2.2 AA compliant - Ratio ~4.7:1 (blanc sur bleu)
    background-color: color('base');
    color: text('invert');

    @include on-event {
      background-color: color(
        'dark'
      ); // ✅ Variant existe dans $primary-color-tokens
    }
  }

  &--danger {
    // Variant pour actions destructives (suppression, annulation)
    background-color: semantic('error', 'base');
    color: text('invert');

    @include on-event {
      background-color: semantic(
        'error',
        'dark'
      ); // ✅ Variant existe dans semantic-tokens
    }
  }

  // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  // STATES
  // ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

  &:disabled,
  &[aria-disabled='true'] {
    opacity: opacity('half'); // 0.5
    pointer-events: none;
  }

  &--loading {
    opacity: opacity('xl'); // 0.8 (plus visible que disabled)
  }
}

// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// SPINNER (Loading State)
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

.btn__spinner {
  display: inline-flex;
  align-items: center;
  gap: spacing('xs');
  margin-inline-end: spacing('xs'); // Propriété logique (RTL-ready)

  @include safe-animation(
    spinner-rotate,
    timing('slower'),
    // 1s → 0.5s (TSA-compliant)
    easing('linear')
  );
}

.btn__spinner-dot {
  display: inline-block;
  width: spacing(
    '6'
  ); // 6px - Tolérance : pas de token size() dédié pour dots 6px
  height: spacing('6');
  border-radius: radius('full'); // 50% (cercle)
  background-color: currentColor;
  opacity: opacity('lg'); // 0.6

  &:nth-child(2) {
    @include safe-animation(
      spinner-fade,
      timing('base'),
      // 0.6s → 0.3s (TSA max)
      easing('ease-in-out')
    );
    animation-delay: 0.1s;
    animation-iteration-count: infinite;
  }

  &:nth-child(3) {
    @include safe-animation(
      spinner-fade,
      timing('base'),
      easing('ease-in-out')
    );
    animation-delay: 0.2s;
    animation-iteration-count: infinite;
  }
}

// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
// KEYFRAMES (Local - Spinner-specific)
// ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

@keyframes spinner-rotate {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@keyframes spinner-fade {
  0% {
    opacity: opacity('lg'); // 0.6
  }
  50% {
    opacity: opacity('opaque'); // 1
  }
  100% {
    opacity: opacity('lg'); // 0.6
  }
}
