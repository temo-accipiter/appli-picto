@use '@styles/abstracts' as *;

// ============================================================================
// NAVBAR COMPONENT
// ============================================================================
// ✅ PHASE 6 VALIDÉ : Wrappers spacing/surface/radius/shadow/text/timing/respond-to avec fallback
//    - spacing('xs'/'sm'/'md'/'lg') → Primitives Phase 6 ✅
//    - surface('bg'/'border'/'hover') → Semantics Phase 6 ✅
//    - shadow('elevation-sm'/'elevation-md') → Primitives Phase 6 ✅
//    - radius('md'/'sm'/'full') → Primitives Phase 6 (12px/6px/50%) ✅
//    - text('invert') → Semantics Phase 6 ✅
//    - timing('fast') → Primitives Phase 6 (0.15s) ✅
//    - easing('ease-out') → Primitives Phase 6 ✅
//    - safe-transition() → Mixin Phase 6 ✅
//    - transition-smooth → Mixin Phase 6 ✅
//    - respond-to() → Mixin responsive Phase 6 ✅
//    - z-index('modal') → Legacy support actif
//    - size('64'/'avatar-md') → Legacy support actif
//    - font-size('sm'/'2xl'/'base') → Legacy support actif
//    - font-weight('medium'/'bold') → Legacy support actif
//    - border-width('thin'/'base') → Legacy support actif
//    - color('base'/'dark') → Legacy support actif
//    - a11y('focus-ring-width'/'focus-ring-offset') → Legacy support actif
// ============================================================================

.navbar {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  z-index: z-index('modal');
  display: flex;
  background-color: surface('bg');
  box-shadow: shadow('elevation-sm');

  /* [Mobile-first] Base = mobile (320px+) */
  flex-direction: column;
  align-items: flex-start;
  gap: spacing('xs');
  height: auto;
  padding: spacing('sm') spacing('md');

  /* Desktop = enhancement */
  @include respond-to(sm) {
    flex-direction: row;
    justify-content: space-between;
    align-items: center;
    height: size('64');
    padding: 0 spacing('lg');
    gap: 0;
  }
}

.navbar-left {
  display: flex;

  /* [Mobile-first] Base = mobile */
  width: 100%;
  flex-wrap: wrap;
  justify-content: center;
  gap: spacing('md');

  /* Desktop = enhancement */
  @include respond-to(sm) {
    width: auto;
    flex-wrap: nowrap;
    justify-content: flex-start;
    gap: spacing('lg');
  }
}

.navbar-actions {
  display: flex;
  align-items: center;

  /* [Mobile-first] Base = mobile */
  width: 100%;
  justify-content: center;
  gap: spacing('sm');

  /* Desktop = enhancement */
  @include respond-to(sm) {
    width: auto;
    justify-content: flex-end;
    gap: spacing('md');
  }

  // Actions spécifiques aux visiteurs
  &.visitor-actions {
    gap: spacing('lg');

    .visitor-controls {
      display: flex;
      align-items: center;
      gap: spacing('sm');
    }

    .visitor-buttons {
      display: flex;
      align-items: center;
      gap: spacing('sm');

      .nav-button {
        display: flex;
        align-items: center;
        gap: spacing('xs');
        padding: spacing('sm') spacing('md');
        border-radius: radius('md');
        font-size: font-size('sm');
        font-weight: font-weight('medium');
        text-decoration: none;
        @include safe-transition(
          background-color transform border-color box-shadow,
          timing('fast'),
          easing('ease-out')
        );
        border: border-width('thin') solid transparent;

        &.signup-button {
          background: color('base');
          color: text('invert');
          border-color: color('base');

          &:hover {
            background: color('dark');
            transform: translateY(calc(-1 * #{border-width('thin')}));
          }
        }

        &.login-button {
          background: transparent;
          color: text();
          border-color: surface('border');

          &:hover {
            background: surface('hover');
            border-color: color('base');
          }
        }

        &.personalize-button {
          background: color('base');
          color: text('invert');
          border-color: color('base');

          &:hover {
            background: color('dark');
            transform: translateY(calc(-1 * #{border-width('thin')}));
            box-shadow: shadow('elevation-md');
          }
        }

        span {
          /* [Mobile-first] Base = mobile (caché pour gagner espace) */
          display: none;

          /* Desktop = afficher le texte */
          @include respond-to(sm) {
            display: inline;
          }
        }
      }
    }
  }
}

.nav-link {
  position: relative;
  display: flex;
  align-items: center;
  gap: spacing('xs');
  font-size: font-size('sm');
  font-weight: font-weight('medium');
  text-decoration: none;
  color: text();
  padding: spacing('xs') 0;

  @include transition-smooth;

  &::after {
    content: '';
    position: absolute;
    left: 0;
    bottom: 0;
    width: 0;
    height: border-width('base');
    background-color: color('base');
    @include safe-transition(width, timing('fast'), easing('ease-out'));
  }

  &:hover {
    color: color('base');

    &::after {
      width: 100%;
    }
  }

  // WCAG 2.4.7 - Focus visible accessible
  &:focus-visible {
    outline: a11y('focus-ring-width') solid color('base');
    outline-offset: spacing('xs');
    border-radius: radius('sm');
  }

  &.active {
    color: color('base');

    &::after {
      width: 100%;
    }
  }
}

.nav-icon-link {
  font-size: font-size('2xl');
  padding: spacing('sm');
  text-decoration: none;
  display: inline-flex;
  align-items: center;
  justify-content: center;
}

.nav-button {
  background: color('base');
  color: text('invert');
  border: none;
  border-radius: radius('md');
  padding: spacing('xs') spacing('sm');
  font-size: font-size('sm');
  margin-left: spacing('md');
  cursor: pointer;
  @include safe-transition(
    background-color,
    timing('fast'),
    easing('ease-out')
  );

  &:hover {
    background: color('dark');
  }

  // WCAG 2.4.7 - Focus visible accessible
  &:focus-visible {
    outline: a11y('focus-ring-width') solid text('invert');
    outline-offset: a11y('focus-ring-offset');
  }
}
.nav-avatar-link {
  display: flex;
  align-items: center;
  justify-content: center;
  margin-left: spacing('md');

  .navbar-avatar {
    width: size('avatar-md');
    height: size('avatar-md');
    border-radius: radius('full');
    overflow: hidden;
    border: border-width('base') solid surface('border');

    img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
  }

  .navbar-avatar-fallback {
    width: size('avatar-md');
    height: size('avatar-md');
    border-radius: radius('full');
    // WCAG 2.2 AA compliant - Ratio ~4.5:1
    background: surface('soft');
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: font-weight('bold');
    color: text();
    font-size: font-size('base');
  }

  &:hover .navbar-avatar {
    transform: scale(1.05);
  }
}
