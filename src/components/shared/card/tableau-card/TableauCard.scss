@use '@styles/abstracts' as *;

// ============================================================================
// TABLEAU CARD COMPONENT
// ============================================================================
// âœ… PHASE 6 VALIDÃ‰ : Wrappers radius/spacing/surface avec fallback
//    - radius('md') â†’ Primitives Phase 6 (12px) âœ…
//    - spacing('xs'/'sm'/'md') â†’ Primitives Phase 6 (4px/8px/16px) âœ…
//    - surface('hover') â†’ Semantics Phase 6 âœ…
//    - tsa-pastel('bg-soft') â†’ Legacy TSA support actif
//    - Mobile-first responsive avec respond-to() âœ…
//    - Autres tokens : Legacy support actif
// ============================================================================

.tableau-card {
  // Base card styling
  background: tsa-pastel('bg-soft');
  border-radius: radius('md');
  box-shadow: shadow('elevation-sm');
  border: border-width('base') solid transparent;

  cursor: grab;
  user-select: none;
  position: relative;

  // Override du overflow pour permettre Ã  l'image de dÃ©passer lors du hover
  overflow: visible;

  // Animation d'apparition lors du swap
  animation: card-swap-in timing('base') easing('bounce');

  // Transitions optimisÃ©es pour Ã©viter les sauts
  @include safe-transition(
    transform opacity box-shadow background-color,
    timing('base'),
    easing('ease-out')
  );

  // Drag actif
  &.dragging {
    opacity: opacity('half');
    cursor: grabbing;
    transform: scale(0.98);
    z-index: z-index('modal');
  }

  // Carte cochÃ©e (tÃ¢che accomplie)
  &.done {
    opacity: opacity('half');
    filter: grayscale(100%);

    span {
      text-decoration: line-through;
    }
  }

  // Image avec transition pour le hover
  img,
  .tableau-card__image {
    @include safe-transition(transform, timing('base'), easing('ease-out'));
  }

  // Hover (si non touch)
  @include on-event {
    background-color: surface('hover');
    transform: scale(1.02);

    // Animation de rotation sur l'image au hover
    img,
    .tableau-card__image {
      transform: scale(1.15) rotate(8deg);
    }
  }

  // ğŸ“± Responsive mobile-first
  /* Base = mobile (320px+) */
  padding: spacing('xs');

  /* Tablet (576px+) */
  @include respond-to(sm) {
    padding: spacing('sm');
  }

  /* Desktop (768px+) */
  @include respond-to(md) {
    padding: spacing('md');
  }

  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
  // Ã‰TATS VISUELS - Focus / Upcoming / Done
  // â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  // Focus : Carte centrale, agrandie
  &--focus {
    transform: scale(1.1);
    box-shadow: shadow('elevation-lg');
    z-index: z-index('dropdown');

    @include respond-to(tablet) {
      transform: scale(1.15);
    }
  }

  // Upcoming : Cartes Ã  venir, plus petites, opacitÃ© rÃ©duite
  &--upcoming {
    transform: scale(0.85);
    opacity: opacity('md');

    @include respond-to(tablet) {
      transform: scale(0.9);
    }
  }

  // Done : Carte terminÃ©e (override du .done existant si state='done')
  &--done {
    opacity: opacity('md');
    filter: grayscale(100%);
  }
}

// Label du tableau
.tableau-card__label {
  font-weight: font-weight('semibold');
  font-size: font-size('sm');
  line-height: line-height('snug');
  word-break: break-word;
}

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// CONTENT - Container image + jetons
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

.tableau-card__content {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
}

// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
// JETONS - EmpilÃ©s verticalement sur le bord droit
// â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

.tableau-card__tokens {
  position: absolute;
  top: spacing('xs');
  right: spacing('xs');
  display: flex;
  flex-direction: column;
  gap: spacing('xs');
  z-index: z-index('base') + 1; // Au-dessus de l'image
}

.tableau-card__token {
  display: block;
  font-size: font-size('lg');
  line-height: 1;
  filter: drop-shadow(shadow('elevation-xs'));

  // Animation entrÃ©e douce
  animation: token-pop timing('xs') easing('smooth-pop') backwards;

  @for $i from 1 through 5 {
    &:nth-child(#{$i}) {
      animation-delay: calc(#{$i} * 50ms);
    }
  }

  @include respond-to(tablet) {
    font-size: font-size('xl');
  }
}

@keyframes token-pop {
  0% {
    opacity: 0;
    transform: scale(0.5) translateY(-10px);
  }
  100% {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

// Wrapper checkbox - isolÃ© du drag
.tableau-card__checkbox-wrapper {
  pointer-events: auto;
}

// Animation de swap fluide
@keyframes card-swap-in {
  0% {
    opacity: opacity('md');
    transform: scale(0.9);
  }
  100% {
    opacity: opacity('opaque');
    transform: scale(1);
  }
}
