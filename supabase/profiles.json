[
  {
    "table_report": {
      "table": {
        "schema": "public",
        "name": "profiles"
      },
      "columns": [
        {
          "column_name": "id",
          "data_type": "uuid",
          "is_nullable": "NO",
          "default": null
        },
        {
          "column_name": "pseudo",
          "data_type": "text",
          "is_nullable": "YES",
          "default": null
        },
        {
          "column_name": "avatar_url",
          "data_type": "text",
          "is_nullable": "YES",
          "default": null
        },
        {
          "column_name": "is_admin",
          "data_type": "boolean",
          "is_nullable": "NO",
          "default": "false"
        },
        {
          "column_name": "created_at",
          "data_type": "timestamp with time zone",
          "is_nullable": "NO",
          "default": "now()"
        },
        {
          "column_name": "updated_at",
          "data_type": "timestamp with time zone",
          "is_nullable": "NO",
          "default": "now()"
        },
        {
          "column_name": "date_naissance",
          "data_type": "date",
          "is_nullable": "YES",
          "default": null
        },
        {
          "column_name": "ville",
          "data_type": "text",
          "is_nullable": "YES",
          "default": null
        },
        {
          "column_name": "account_status",
          "data_type": "text",
          "is_nullable": "NO",
          "default": "'active'::text"
        },
        {
          "column_name": "deletion_scheduled_at",
          "data_type": "timestamp with time zone",
          "is_nullable": "YES",
          "default": null
        }
      ],
      "rls": {
        "rls_enabled": true,
        "rls_forced": false
      },
      "policies": [
        {
          "policyname": "profiles_admin_all",
          "command": "ALL",
          "roles": [
            "authenticated"
          ],
          "using": "is_admin()",
          "with_check": "is_admin()"
        },
        {
          "policyname": "profiles_insert_own",
          "command": "INSERT",
          "roles": [
            "authenticated"
          ],
          "using": null,
          "with_check": "(auth.uid() = id)"
        },
        {
          "policyname": "profiles_select_own",
          "command": "SELECT",
          "roles": [
            "authenticated"
          ],
          "using": "(auth.uid() = id)",
          "with_check": null
        },
        {
          "policyname": "profiles_update_own",
          "command": "UPDATE",
          "roles": [
            "authenticated"
          ],
          "using": "(auth.uid() = id)",
          "with_check": "(auth.uid() = id)"
        }
      ],
      "indexes": [
        {
          "name": "idx_profiles_account_status",
          "def": "CREATE INDEX idx_profiles_account_status ON public.profiles USING btree (account_status)"
        },
        {
          "name": "idx_profiles_deletion_scheduled",
          "def": "CREATE INDEX idx_profiles_deletion_scheduled ON public.profiles USING btree (deletion_scheduled_at) WHERE (account_status = 'deletion_scheduled'::text)"
        },
        {
          "name": "idx_profiles_is_admin",
          "def": "CREATE INDEX idx_profiles_is_admin ON public.profiles USING btree (is_admin)"
        },
        {
          "name": "idx_profiles_updated_at",
          "def": "CREATE INDEX idx_profiles_updated_at ON public.profiles USING btree (updated_at DESC)"
        },
        {
          "name": "profiles_pkey",
          "def": "CREATE UNIQUE INDEX profiles_pkey ON public.profiles USING btree (id)"
        },
        {
          "name": "profiles_pseudo_unique",
          "def": "CREATE UNIQUE INDEX profiles_pseudo_unique ON public.profiles USING btree (pseudo)"
        }
      ],
      "constraints": [
        {
          "name": "profiles_account_status_check",
          "type": "c",
          "definition": "CHECK ((account_status = ANY (ARRAY['active'::text, 'suspended'::text, 'deletion_scheduled'::text, 'pending_verification'::text])))"
        },
        {
          "name": "profiles_birthdate_chk",
          "type": "c",
          "definition": "CHECK (((date_naissance IS NULL) OR (date_naissance <= CURRENT_DATE)))"
        },
        {
          "name": "profiles_id_fkey",
          "type": "f",
          "definition": "FOREIGN KEY (id) REFERENCES auth.users(id) ON DELETE CASCADE"
        },
        {
          "name": "profiles_pkey",
          "type": "p",
          "definition": "PRIMARY KEY (id)"
        },
        {
          "name": "profiles_pseudo_unique",
          "type": "u",
          "definition": "UNIQUE (pseudo)"
        }
      ],
      "triggers": [
        {
          "name": "set_profiles_updated_at",
          "enabled": "O",
          "definition": "CREATE TRIGGER set_profiles_updated_at BEFORE INSERT OR UPDATE ON profiles FOR EACH ROW EXECUTE FUNCTION set_updated_at()",
          "function_name": "set_updated_at"
        }
      ],
      "data_preview": [
        {
          "id": "fbe8d0fe-347d-4b32-86f1-af640f75a307",
          "pseudo": "accipiter",
          "avatar_url": "fbe8d0fe-347d-4b32-86f1-af640f75a307/1757768218112-avatar_fbe8d0fe-347d-4b32-86f1-af640f75a307_1757768217678.png",
          "is_admin": true,
          "created_at": "2025-09-02T18:00:24.182404+00:00",
          "updated_at": "2025-09-13T12:56:59.488942+00:00",
          "date_naissance": "2025-09-06",
          "ville": "poti",
          "account_status": "active",
          "deletion_scheduled_at": null
        },
        {
          "id": "d691b0fd-6968-41f4-b307-233c2a2252c2",
          "pseudo": "lt.miminoshvili",
          "avatar_url": null,
          "is_admin": false,
          "created_at": "2025-09-16T12:01:09.981774+00:00",
          "updated_at": "2025-09-16T12:01:09.981774+00:00",
          "date_naissance": null,
          "ville": null,
          "account_status": "active",
          "deletion_scheduled_at": null
        },
        {
          "id": "5841742b-b57a-47e3-82f8-17ce9cd79546",
          "pseudo": "accipiter.ae75",
          "avatar_url": null,
          "is_admin": false,
          "created_at": "2025-09-20T06:01:40.91314+00:00",
          "updated_at": "2025-09-20T06:01:40.91314+00:00",
          "date_naissance": null,
          "ville": null,
          "account_status": "active",
          "deletion_scheduled_at": null
        }
      ],
      "functions": [
        {
          "name": "is_admin",
          "definition": "CREATE OR REPLACE FUNCTION public.is_admin()\n RETURNS boolean\n LANGUAGE sql\n STABLE SECURITY DEFINER\n SET search_path TO 'public'\nAS $function$\n  select exists (\n    select 1 from public.user_roles ur\n    join public.roles r on r.id = ur.role_id\n    where ur.user_id = auth.uid() and ur.is_active and r.name='admin'\n  ) or exists (select 1 from public.profiles p where p.id=auth.uid() and p.is_admin);\n$function$\n"
        },
        {
          "name": "set_updated_at",
          "definition": "CREATE OR REPLACE FUNCTION public.set_updated_at()\n RETURNS trigger\n LANGUAGE plpgsql\n SET search_path TO 'pg_catalog', 'public'\nAS $function$\nbegin\n  new.updated_at := now();\n  return new;\nend$function$\n"
        }
      ]
    }
  }
]